{"openapi":"3.0.0","info":{"title":"Usable API","version":"1.4.0","description":"\n# Usable API Documentation\n\nUsable is an AI-enhanced team knowledge platform that enables development teams to capture, organize, and share knowledge through workspace-based collaboration. This API provides endpoints for MCP server integration and direct application access.\n\n## Authentication\n\nThe Usable API supports two authentication methods:\n\n### 1. Personal Access Tokens (Recommended for MCP Servers)\n- Generate tokens via the web interface or /api/tokens endpoint\n- Include in requests via Authorization: Bearer <token> header\n- Tokens can have workspace-specific permissions and expiration dates\n\n### 2. Session-based Authentication\n- Used by the web interface\n- Session cookies managed automatically by NextAuth\n\n## Permission System\n\nUsers have different roles in workspaces:\n- **Owner**: Full workspace control (manage members, delete workspace, all fragment operations)\n- **Collaborator**: Fragment management (create, edit, delete fragments)\n- **Viewer**: Read-only access (view fragments, search)\n- **Subscriber**: View-only access to public workspaces\n\n## Memory Fragment Types\n\nUsable supports four types of knowledge fragments:\n\n1. **Knowledge**: General information and documentation\n2. **Recipe**: Step-by-step guides and tutorials  \n3. **Solution**: Solutions to specific problems and errors\n4. **Template**: Reusable code patterns and project templates\n\n## Error Responses\n\nAll endpoints return consistent error responses with HTTP status codes:\n\n- **400**: Bad Request - Invalid input data\n- **401**: Unauthorized - Missing or invalid authentication\n- **403**: Forbidden - Insufficient permissions\n- **404**: Not Found - Resource does not exist or access denied\n- **500**: Internal Server Error - Server-side error\n    ","contact":{"name":"Usable Support","email":"support@usable.dev"},"license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"}},"servers":[{"url":"http://localhost:3001","description":"Development server"},{"url":"https://usable.dev","description":"Production server"}],"components":{"securitySchemes":{"BearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT","description":"Personal Access Token for API authentication"},"SessionAuth":{"type":"apiKey","in":"cookie","name":"next-auth.session-token","description":"Session-based authentication for web interface"}},"schemas":{"FragmentType":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","enum":["Knowledge","Recipe","Solution","Template"],"description":"Fragment type name - determines structure and behavior"},"description":{"type":"string","nullable":true},"color":{"type":"string","description":"Hex color code for UI theming","pattern":"^#[0-9A-Fa-f]{6}$"},"icon":{"type":"string","description":"icon name for UI display"},"workspaceId":{"type":"string","format":"uuid"},"isActive":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}},"MemoryFragment":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"fragmentTypeId":{"type":"string","format":"uuid"},"fragmentType":{"$ref":"#/components/schemas/FragmentType"},"title":{"type":"string","maxLength":500},"summary":{"type":"string","nullable":true},"content":{"type":"string","description":"Main content - supports Markdown"},"tags":{"type":"array","items":{"type":"string"},"description":"Array of tags for categorization and search"},"status":{"type":"string","enum":["draft","published","archived"],"description":"Fragment status - only published fragments are searchable"},"createdVia":{"type":"string","enum":["web","mcp","api"],"description":"How the fragment was created"},"authorId":{"type":"string","format":"uuid"},"author":{"$ref":"#/components/schemas/User"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}},"FragmentUpdate":{"type":"object","description":"Memory fragment with complete context for MCP server integration","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"fragmentTypeId":{"type":"string","format":"uuid"},"title":{"type":"string","maxLength":500},"summary":{"type":"string","nullable":true},"content":{"type":"string","description":"Main content - supports Markdown"},"tags":{"type":"array","items":{"type":"string"},"description":"Array of tags for categorization and search"},"vectorEmbedding":{"type":"array","items":{"type":"number"},"description":"AI embedding vector for semantic search","nullable":true},"status":{"type":"string","enum":["draft","active","archived"],"description":"Fragment status - only active fragments are searchable"},"createdVia":{"type":"string","enum":["web","mcp","api"],"description":"How the fragment was created"},"createdBy":{"type":"string","format":"uuid","description":"ID of the user who created this fragment"},"metadata":{"type":"object","description":"Additional metadata associated with the fragment"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"author":{"type":"object","description":"Information about the fragment author","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","nullable":true,"description":"Display name of the author"},"email":{"type":"string","format":"email","description":"Email of the author"},"image":{"type":"string","nullable":true,"description":"Profile image URL of the author"}},"required":["id","email"]},"fragmentType":{"type":"object","description":"Fragment type information","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","enum":["Knowledge","Recipe","Solution","Template"],"description":"Fragment type name"},"description":{"type":"string","nullable":true,"description":"Fragment type description"},"icon":{"type":"string","description":"icon name for UI display"},"color":{"type":"string","description":"Hex color code for UI theming"},"isSystemDefault":{"type":"boolean","description":"Whether this is a system default type"}},"required":["id","name","icon","color","isSystemDefault"]},"workspace":{"type":"object","description":"Workspace information","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","description":"Name of the workspace"},"visibility":{"type":"string","enum":["private","public"],"description":"Workspace visibility setting"}},"required":["id","name","visibility"]}},"required":["id","workspaceId","fragmentTypeId","title","content","tags","status","createdVia","createdBy","metadata","createdAt","updatedAt","author","fragmentType","workspace"]},"AddOperation":{"type":"object","properties":{"type":{"type":"string","enum":["add"]},"lineNumber":{"type":"integer","minimum":1,"description":"Line number to insert at (1-based indexing)"},"lines":{"type":"array","items":{"type":"string"},"minItems":1,"maxItems":1000,"description":"Array of lines to insert"}},"required":["type","lineNumber","lines"],"description":"Insert lines at a specific line number"},"DeleteOperation":{"type":"object","properties":{"type":{"type":"string","enum":["delete"]},"startLine":{"type":"integer","minimum":1,"description":"First line to delete (1-based indexing, inclusive)"},"endLine":{"type":"integer","minimum":1,"description":"Last line to delete (1-based indexing, inclusive)"}},"required":["type","startLine","endLine"],"description":"Delete lines from startLine to endLine (inclusive)"},"ReplaceOperation":{"type":"object","properties":{"type":{"type":"string","enum":["replace"]},"searchText":{"type":"string","minLength":1,"description":"Text to search for and replace (exact string match, case-sensitive)"},"replaceText":{"type":"string","description":"Text to replace the found text with (can be empty string for deletion)"},"replaceAll":{"type":"boolean","default":false,"description":"If true, replace all occurrences. If false, replace only first occurrence"},"throwIfNotFound":{"type":"boolean","default":true,"description":"If true (default), throws error when searchText not found. Set to false to silently skip."}},"required":["type","searchText","replaceText"],"description":"Search and replace text using exact string matching"},"PatchOperation":{"oneOf":[{"$ref":"#/components/schemas/AddOperation"},{"$ref":"#/components/schemas/DeleteOperation"},{"$ref":"#/components/schemas/ReplaceOperation"}],"discriminator":{"propertyName":"type","mapping":{"add":"#/components/schemas/AddOperation","delete":"#/components/schemas/DeleteOperation","replace":"#/components/schemas/ReplaceOperation"}},"description":"Patch operation for precise content modifications"},"UpdateFragmentRequest":{"type":"object","properties":{"fragmentId":{"type":"string","format":"uuid","description":"UUID of the fragment to update"},"title":{"type":"string","maxLength":500,"description":"Updated title for the fragment"},"summary":{"type":"string","maxLength":5000,"description":"Updated summary for the fragment"},"content":{"type":"string","maxLength":50000,"description":"Complete content replacement (legacy mode). Cannot be used with patchOperations"},"patchOperations":{"type":"array","items":{"$ref":"#/components/schemas/PatchOperation"},"minItems":1,"maxItems":100,"description":"Array of patch operations for precise content modifications. Cannot be used with content field"},"tags":{"type":"array","items":{"type":"string","pattern":"^[a-zA-Z0-9_:-]+$"},"maxItems":20,"description":"Updated tags for the fragment"},"fragmentTypeId":{"type":"string","format":"uuid","description":"Change fragment type UUID"}},"required":["fragmentId"],"description":"Request to update an existing memory fragment. Supports both legacy mode (content field) and patch mode (patchOperations array)"},"SearchResult":{"type":"object","properties":{"fragments":{"type":"array","items":{"$ref":"#/components/schemas/MemoryFragment"}},"totalCount":{"type":"integer"},"hasMore":{"type":"boolean"}}},"AgenticSearchRequest":{"type":"object","required":["query"],"properties":{"query":{"type":"string","minLength":1,"maxLength":2000,"description":"Natural-language query for vector-based semantic search (matches meaning, not keywords).","example":"How to configure Next.js API routes with authentication?"},"context":{"type":"string","maxLength":3000,"description":"Optional additional context to guide relevance."},"searchIntent":{"type":"string","maxLength":1000,"description":"Recommended. Provide a concise high-level objective to bias selection and expansion steps (e.g. 'quick scan', 'deep research', 'summarise onboarding docs'); setting this greatly improves retrieval relevance.","example":"quick scan"},"workspaceId":{"type":"string","format":"uuid","description":"Primary workspace scope; overrides workspaceIds if present."},"workspaceIds":{"type":"array","maxItems":10,"items":{"type":"string","format":"uuid"},"description":"Alternative multi-workspace scope when workspaceId is not provided."},"fragmentTypeId":{"type":"string","format":"uuid","description":"Filter results by a specific fragment type ID."},"tags":{"type":"array","maxItems":10,"items":{"type":"string"},"description":"Filter by tags (allowed: a-z, A-Z, 0-9, '_', '-', ':'). Invalid characters are sanitized upstream.","example":["nextjs","api"]},"limit":{"type":"integer","minimum":5,"maximum":50,"default":10,"description":"Number of fragments to return (5â€“50)."},"maxSearchTimeSeconds":{"type":"integer","minimum":1,"maximum":300,"description":"Optional maximum search time in seconds. If specified, search will bail early when time limit is reached and return partial results with a timeout indicator."},"outputFormat":{"type":"string","enum":["json","text"],"default":"json","description":"Output format for results. 'json' returns structured data (default), 'text' returns human-readable formatted text."},"invocationAttempt":{"type":"integer","minimum":1,"description":"Optional 1-based attempt count supplied by the orchestrating agent to coordinate retries across tool invocations."},"maxInvocationAttempts":{"type":"integer","minimum":1,"description":"Optional ceiling for orchestrator attempts; when reached, the tool short-circuits to avoid redundant retrieval cycles."}}},"AgenticSearchResponse":{"type":"object","properties":{"query":{"type":"string","description":"The search query that was executed"},"fragments":{"type":"array","description":"Selected fragments with relevance information","items":{"type":"object","properties":{"fragmentId":{"type":"string","format":"uuid"},"title":{"type":"string"},"reason":{"type":"string","description":"Explanation of why this fragment was selected"},"confidence":{"type":"number","description":"Confidence score (0-1)","minimum":0,"maximum":1},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}},"required":["fragmentId","title","reason","confidence"]}},"executionTimeMs":{"type":"integer","description":"Time taken to execute the search in milliseconds"},"decision":{"type":"string","enum":["SUFFICIENT","NEED_MORE","NO_RESULTS"],"description":"Search result status: SUFFICIENT = found relevant results, NEED_MORE = found some but may need refinement, NO_RESULTS = nothing relevant found (use suggestedQueries to retry)"},"invocationLimitReached":{"type":"boolean","description":"Whether the invocation limit was reached"},"invocationAttempt":{"type":"integer","description":"Current invocation attempt number"},"maxInvocationAttempts":{"type":"integer","description":"Maximum allowed invocation attempts"},"iterations":{"type":"integer","description":"Number of expansion iterations performed"},"maxIterations":{"type":"integer","description":"Maximum allowed expansion iterations"},"maxIterationsReached":{"type":"boolean","description":"Whether the maximum iterations limit was reached"},"timeoutReached":{"type":"boolean","description":"Whether the search timeout was reached"},"timeoutSeconds":{"type":"integer","description":"Timeout limit in seconds (only present if timeoutReached is true)"},"reformulations":{"type":"array","items":{"type":"string"},"description":"Suggested follow-up queries (only present if decision is NEED_MORE)"},"suggestedQueries":{"type":"array","items":{"type":"string"},"description":"Alternative search queries to try when decision is NO_RESULTS. Use these to retry immediately with different search terms."},"primed":{"type":"array","description":"Initial primed fragments before expansion (only present if fallback was used)","items":{"type":"object","properties":{"fragmentId":{"type":"string","format":"uuid"},"title":{"type":"string"},"summary":{"type":"string"},"preview":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}}}},"required":["query","fragments","executionTimeMs","decision"]},"ListFragmentsRequest":{"type":"object","properties":{"workspaceId":{"type":"string","format":"uuid","description":"Optional. Target workspace UUID. If omitted, searches all accessible workspaces."},"fragmentTypeId":{"type":"string","format":"uuid","description":"Optional. Filter by fragment type UUID."},"tags":{"type":"array","items":{"type":"string"},"description":"Optional. Filter by tags. Returns fragments that have ANY of the specified tags (OR logic).","example":["nextjs","api"]},"where":{"type":"string","description":"Optional. SQL WHERE clause for advanced filtering (alias for `query`). Supports operators: =, !=, >, <, >=, <=, LIKE, ILIKE, IN, NOT IN, @> (for JSON arrays). Example: `status = 'active' AND created_at >= '2024-01-01'`","example":"status = 'active' AND tags @> ARRAY['nextjs']"},"query":{"type":"string","description":"Optional. SQL WHERE clause for advanced filtering (preferred over `where`). Supports operators: =, !=, >, <, >=, <=, LIKE, ILIKE, IN, NOT IN, @> (for JSON arrays). Example: `status = 'active' AND created_at >= '2024-01-01'`","example":"status = 'active' AND tags @> ARRAY['nextjs']"},"orderBy":{"type":"string","description":"Optional. SQL ORDER BY clause. Example: `created_at DESC` or `updated_at ASC` or `title ASC`. Default: `created_at DESC`.","example":"created_at DESC"},"select":{"type":"array","items":{"type":"string"},"description":"Optional. Array of column names to return. If not specified, returns all columns. Valid columns: id, fragment_type_id, title, summary, status, created_by, created_at, updated_at, tags. Also supports aggregate functions: COUNT(column), SUM(column), AVG(column). Example: ['id', 'title', 'COUNT(*) AS count']","example":["id","title","status"]},"groupBy":{"type":"array","items":{"type":"string"},"description":"Optional. Array of column names to group by. Required when using aggregate functions with non-aggregate columns. Example: ['status', 'fragment_type_id']","example":["fragment_type_id"]},"createdAfter":{"type":"string","format":"date-time","description":"Optional. Filter fragments created after this date (ISO 8601 format).","example":"2024-01-15T00:00:00Z"},"updatedAfter":{"type":"string","format":"date-time","description":"Optional. Filter fragments updated after this date (ISO 8601 format).","example":"2024-01-15T00:00:00Z"},"status":{"type":"string","enum":["active","stale","archived"],"description":"Optional. Filter by fragment status. Default: 'active' and 'stale'. Use 'archived' to include archived fragments."},"limit":{"type":"integer","minimum":1,"maximum":100,"default":20,"description":"Maximum number of fragments to return. Default: 20, Max: 100."},"offset":{"type":"integer","minimum":0,"default":0,"description":"Number of fragments to skip for pagination. Default: 0."}}},"ListFragmentsResponse":{"type":"object","properties":{"fragments":{"type":"array","description":"Array of fragments. When `isAggregate` is true, contains raw objects with selected columns/aggregate results. When false, contains standard fragment objects.","items":{"type":"object","description":"Fragment object (standard format) or raw result object (when using select/aggregate queries)","additionalProperties":true,"properties":{"id":{"type":"string","format":"uuid"},"title":{"type":"string"},"summary":{"type":"string","nullable":true},"tags":{"type":"array","items":{"type":"string"}},"fragmentTypeId":{"type":"string","format":"uuid"},"fragmentType":{"$ref":"#/components/schemas/FragmentType"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"author":{"$ref":"#/components/schemas/User"},"workspaceId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["active","stale","archived"]}}}},"totalCount":{"type":"integer","description":"Total number of fragments matching the filters"},"limit":{"type":"integer","description":"Maximum number of fragments requested"},"offset":{"type":"integer","description":"Number of fragments skipped"},"hasMore":{"type":"boolean","description":"Whether there are more results available"},"isAggregate":{"type":"boolean","description":"Whether the response contains aggregate query results (when using COUNT, SUM, AVG with GROUP BY)"}},"required":["fragments","totalCount","limit","offset","hasMore","isAggregate"]},"SavedSearch":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"userId":{"type":"string","format":"uuid"},"name":{"type":"string","maxLength":255,"description":"Display name for the saved search"},"query":{"type":"string","nullable":true,"description":"Search query text"},"filters":{"type":"object","nullable":true,"properties":{"fragmentTypeIds":{"type":"array","items":{"type":"string","format":"uuid"},"description":"Filter by fragment type IDs"},"tags":{"type":"array","items":{"type":"string"},"description":"Filter by tags"},"authors":{"type":"array","items":{"type":"string","format":"uuid"},"description":"Filter by author user IDs"},"dateRange":{"type":"object","properties":{"from":{"type":"string","format":"date"},"to":{"type":"string","format":"date"}},"description":"Date range filter"},"createdVia":{"type":"array","items":{"type":"string","enum":["web","mcp","api"]},"description":"Filter by creation method"}},"description":"Search filters"},"createdAt":{"type":"string","format":"date-time","description":"When the search was saved"}},"required":["id","workspaceId","userId","name","createdAt"]},"SubscriptionTier":{"type":"object","properties":{"id":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"Tier identifier"},"name":{"type":"string","description":"Display name of the tier"},"displayName":{"type":"string","description":"Human-readable tier name"},"monthlyFee":{"type":"number","description":"Monthly subscription fee in dollars"},"storageIncludedGb":{"type":"number","description":"Storage included in GB"},"generationTokensIncludedPerMonth":{"type":"integer","description":"Generation tokens included per month"},"embeddingsIncludedPerMonth":{"type":"integer","description":"Embedding tokens included per month"},"graphAccess":{"type":"boolean","description":"Whether the tier includes graph access"},"supportChannel":{"type":"string","enum":["community","email","slack"],"description":"Support channel available for this tier"}}},"UserSubscriptionInfo":{"type":"object","description":"Detailed subscription information including billing period, costs, and usage","properties":{"id":{"type":"string","description":"Subscription identifier"},"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"Current effective tier name"},"subscribedAt":{"type":"string","format":"date-time","description":"Subscription timestamp"},"billingPeriod":{"type":"object","properties":{"start":{"type":"string","format":"date-time"},"end":{"type":"string","format":"date-time"},"nextBillingDate":{"type":"string","format":"date-time"},"daysRemaining":{"type":"integer"},"isAnniversaryBilling":{"type":"boolean"}}},"costBreakdown":{"type":"object","properties":{"baseCostCents":{"type":"integer"},"storageCostCents":{"type":"integer"},"generationTokenCostCents":{"type":"integer"},"embeddingTokenCostCents":{"type":"integer"},"subtotalCents":{"type":"integer"},"discountAmountCents":{"type":"integer"},"discountPercentage":{"type":"number"},"discountReason":{"type":"string","nullable":true},"totalCents":{"type":"integer"}}},"usage":{"type":"object","properties":{"storage":{"type":"object","properties":{"usedGb":{"type":"number"},"includedGb":{"type":"number"},"overageGb":{"type":"number"},"ratePerGb":{"type":"number"}}},"generationTokens":{"type":"object","properties":{"used":{"type":"integer"},"included":{"type":"integer"},"overage":{"type":"integer"},"ratePerThousand":{"type":"number"}}},"embeddingTokens":{"type":"object","properties":{"used":{"type":"integer"},"included":{"type":"integer"},"overage":{"type":"integer"},"ratePerThousand":{"type":"number"}}}}},"storageUsageGb":{"type":"number"},"workspaceCount":{"type":"integer"},"memberCount":{"type":"integer"},"estimatedCost":{"type":"number"},"lastBillingAmount":{"type":"number"}}},"EffectiveSubscriptionResponse":{"type":"object","description":"Effective subscription information showing the billing source (organization or personal) and tier details","required":["tierName","tierDisplayName","billingSource","tier","effectiveAt"],"properties":{"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"The effective tier the user is operating under"},"tierDisplayName":{"type":"string","description":"Human-readable name of the effective tier","example":"Pro"},"billingSource":{"type":"string","enum":["organization","personal"],"description":"Whether the user is billing through an organization or their personal account"},"organization":{"type":"object","nullable":true,"description":"Organization details (only present if billingSource is 'organization')","properties":{"id":{"type":"string","format":"uuid","description":"Organization ID"},"name":{"type":"string","description":"Organization name"},"slug":{"type":"string","description":"Organization URL-friendly slug"},"role":{"type":"string","enum":["owner","admin","member"],"description":"User's role in the organization"},"isActive":{"type":"boolean","description":"Whether the organization subscription is active"}}},"personalSubscription":{"type":"object","nullable":true,"description":"Personal subscription details (for reference, even when billing through organization)","properties":{"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"Personal subscription tier"},"isActive":{"type":"boolean","description":"Whether the personal subscription is active"},"stripeSubscriptionId":{"type":"string","nullable":true,"description":"Stripe subscription ID if on a paid personal plan"}}},"tier":{"type":"object","description":"Details of the effective tier","properties":{"monthlyFee":{"type":"number","description":"Monthly fee in dollars"},"storageIncludedGb":{"type":"number","description":"Storage included in GB"},"generationTokensIncludedPerMonth":{"type":"integer","description":"Generation tokens included per month"},"embeddingsIncludedPerMonth":{"type":"integer","description":"Embedding tokens included per month"},"graphAccess":{"type":"boolean","description":"Whether graph access is included"},"supportChannel":{"type":"string","description":"Support channel (community, email, slack)"}}},"effectiveAt":{"type":"string","format":"date-time","description":"Timestamp when this information was retrieved"}}},"User":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"email":{"type":"string","format":"email"},"name":{"type":"string"},"role":{"type":"string","enum":["admin","user"],"description":"Global user role"},"isActive":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}},"UserAnalyticsSummary":{"type":"object","properties":{"storage":{"type":"object","properties":{"totalSizeBytes":{"type":"integer","description":"Total storage used in bytes"},"totalSizeGb":{"type":"number","description":"Total storage used in GB"},"fragmentCount":{"type":"integer","description":"Total number of memory fragments"},"ownedWorkspaceCount":{"type":"integer","description":"Number of owned workspaces"},"currentTier":{"type":"object","properties":{"name":{"type":"string","enum":["free","starter","pro","enterprise"]},"storageIncludedGb":{"type":"number"},"workspaceLimit":{"type":"integer","nullable":true}}},"storageAllowanceGb":{"type":"number"},"storageUsedPercentage":{"type":"number","description":"Percentage of storage allowance used"},"isWithinLimits":{"type":"boolean","description":"Whether storage is within tier limits"},"workspaceBreakdown":{"type":"array","items":{"type":"object","properties":{"workspaceId":{"type":"string","format":"uuid"},"workspaceName":{"type":"string"},"sizeBytes":{"type":"integer"},"sizeGb":{"type":"number"},"fragmentCount":{"type":"integer"}}}},"monthlyGrowth":{"type":"object","properties":{"currentMonthGb":{"type":"number"},"lastMonthGb":{"type":"number"},"growthPercentage":{"type":"number"}}}}},"embeddings":{"type":"object","properties":{"weeklyUsage":{"type":"object","properties":{"tokensUsed":{"type":"integer"},"tokensLimit":{"type":"integer"},"tokensRemaining":{"type":"integer"},"costCents":{"type":"number"},"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"User's current subscription tier"},"weekStart":{"type":"string","format":"date"},"isLimitExceeded":{"type":"boolean"},"usagePercentage":{"type":"number"}}},"monthlyStats":{"type":"object","properties":{"totalTokens":{"type":"integer"},"totalCostCents":{"type":"integer"},"requestCount":{"type":"integer"},"successfulRequests":{"type":"integer"},"failedRequests":{"type":"integer"},"averageTokensPerRequest":{"type":"integer"},"successRate":{"type":"number"}}},"historicalUsage":{"type":"array","items":{"type":"object","properties":{"weekStart":{"type":"string","format":"date"},"tokensUsed":{"type":"integer"},"costCents":{"type":"number"}}}}}},"billing":{"type":"object","properties":{"currentMonthChargesCents":{"type":"integer","description":"Current month charges in cents"},"projectedMonthChargesCents":{"type":"integer","description":"Projected month charges in cents"},"formattedCurrentCharges":{"type":"string","description":"Formatted current charges (e.g., '$1.50')"},"formattedProjectedCharges":{"type":"string","description":"Formatted projected charges (e.g., '$1.50')"}}}},"required":["storage","embeddings","billing"]},"Workspace":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","maxLength":255},"description":{"type":"string","nullable":true},"visibility":{"type":"string","enum":["private","public"],"description":"Workspace visibility - public workspaces can be discovered and subscribed to"},"ownerId":{"type":"string","format":"uuid"},"owner":{"$ref":"#/components/schemas/User"},"memberRole":{"type":"string","enum":["owner","collaborator","contributor","viewer","subscriber"],"description":"Current user's role in this workspace"},"memberCount":{"type":"integer","minimum":0},"fragmentCount":{"type":"integer","minimum":0},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"archivedAt":{"type":"string","format":"date-time","nullable":true}}},"WorkspaceMember":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"userId":{"type":"string","format":"uuid"},"user":{"$ref":"#/components/schemas/User"},"role":{"type":"string","enum":["owner","collaborator","contributor","viewer"],"description":"Member role in workspace"},"invitedAt":{"type":"string","format":"date-time"},"joinedAt":{"type":"string","format":"date-time","nullable":true}}},"ConceptEvolution":{"type":"object","required":["x","y","z"],"properties":{"x":{"type":"string","minLength":1,"example":"microservices"},"y":{"type":"array","items":{"type":"string","minLength":1},"minItems":1,"example":["service mesh","distributed systems"]},"z":{"type":"string","minLength":1,"example":"modularity"},"type":{"type":"string","nullable":true,"example":"technical"}}},"TagAlias":{"type":"object","required":["tag","aliases"],"properties":{"tag":{"type":"string","minLength":1,"example":"ai"},"aliases":{"type":"array","items":{"type":"string","minLength":1},"minItems":1,"example":["artificial intelligence","ml"]},"reason":{"type":"string","nullable":true}}},"WorkspaceSettings":{"type":"object","properties":{"conceptEvolution":{"type":"array","items":{"$ref":"#/components/schemas/ConceptEvolution"},"default":[]},"tagAliases":{"type":"array","items":{"$ref":"#/components/schemas/TagAlias"},"default":[]},"allowGuestAccess":{"type":"boolean"},"defaultMemberRole":{"type":"string","enum":["owner","collaborator","viewer"]},"aiGraphEnabled":{"type":"boolean"}}},"WorkspaceSettingsResponse":{"type":"object","properties":{"workspaceId":{"type":"string","format":"uuid"},"workspaceName":{"type":"string"},"settings":{"$ref":"#/components/schemas/WorkspaceSettings"}}},"UpdateWorkspaceSettingsRequest":{"type":"object","properties":{"conceptEvolution":{"type":"array","items":{"$ref":"#/components/schemas/ConceptEvolution"}},"tagAliases":{"type":"array","items":{"$ref":"#/components/schemas/TagAlias"}}}},"File":{"type":"object","properties":{"id":{"type":"string","description":"File ID (short UUID without dashes)","example":"a1b2c3d4e5f6"},"workspaceId":{"type":"string","format":"uuid","description":"ID of the workspace this file belongs to"},"name":{"type":"string","maxLength":500,"description":"File name (sanitized)","example":"document.pdf"},"mimeType":{"type":"string","description":"MIME type of the file","example":"application/pdf"},"sizeBytes":{"type":"integer","minimum":0,"description":"File size in bytes","example":1024000},"checksum":{"type":"string","description":"SHA-256 checksum of the file content","example":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"},"tags":{"type":"array","items":{"type":"string"},"description":"Tags for file categorization and search","example":["document","report","2024"]},"status":{"type":"string","enum":["active","deleted"],"description":"File status","example":"active"},"uploadedBy":{"type":"string","format":"uuid","description":"ID of the user who uploaded the file"},"createdAt":{"type":"string","format":"date-time","description":"When the file was uploaded"},"updatedAt":{"type":"string","format":"date-time","description":"When the file was last updated"}},"required":["id","workspaceId","name","mimeType","sizeBytes","checksum","status"]},"FileUploadRequest":{"type":"object","description":"File upload request using multipart/form-data","properties":{"file":{"type":"string","format":"binary","description":"File to upload (multipart/form-data). Max size: 50MB"},"workspaceId":{"type":"string","format":"uuid","description":"Workspace ID to upload the file to"},"tags":{"type":"string","description":"JSON array or comma-separated list of tags","example":"[\"document\", \"report\"]"}},"required":["file","workspaceId"]},"FileUploadResponse":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fileId":{"type":"string","description":"File ID for status polling","example":"a1b2c3d4e5f6"},"status":{"type":"string","enum":["uploading"],"description":"Initial upload status","example":"uploading"},"message":{"type":"string","example":"File upload initiated"}},"required":["success","fileId","status"]},"FileStatus":{"type":"object","properties":{"status":{"type":"string","enum":["uploading","complete","corrupted","error"],"description":"Current upload status"},"progress":{"type":"integer","minimum":0,"maximum":100,"description":"Upload progress percentage (0-100)","example":75}},"required":["status"]},"FileMetadata":{"type":"object","properties":{"id":{"type":"string","example":"a1b2c3d4e5f6"},"name":{"type":"string","example":"document.pdf"},"mimeType":{"type":"string","example":"application/pdf"},"sizeBytes":{"type":"integer","example":1024000},"tags":{"type":"array","items":{"type":"string"},"example":["document","report"]},"status":{"type":"string","enum":["active","deleted"]},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"workspace":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string"}}},"uploadedBy":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","nullable":true},"email":{"type":"string","format":"email"}}}},"required":["id","name","mimeType","sizeBytes","status"]},"FileUpdate":{"type":"object","properties":{"name":{"type":"string","minLength":1,"maxLength":500,"description":"New file name (optional)"},"tags":{"type":"array","items":{"type":"string"},"description":"Updated tags array (optional)"}}},"FileSearchResponse":{"type":"object","properties":{"success":{"type":"boolean","example":true},"files":{"type":"array","items":{"$ref":"#/components/schemas/FileMetadata"}},"total":{"type":"integer","description":"Total number of files matching the search","example":42},"limit":{"type":"integer","description":"Number of results per page","example":50},"offset":{"type":"integer","description":"Number of results skipped","example":0}},"required":["success","files","total"]},"FileAttachment":{"type":"object","properties":{"id":{"type":"string","format":"uuid","description":"Attachment ID"},"fileId":{"type":"string","description":"File ID","example":"a1b2c3d4e5f6"},"fragmentId":{"type":"string","format":"uuid","description":"Fragment ID this file is attached to"},"description":{"type":"string","nullable":true,"description":"Optional description of the attachment"},"displayOrder":{"type":"integer","description":"Display order for sorting attachments","example":0},"attachedAt":{"type":"string","format":"date-time","description":"When the file was attached"},"file":{"$ref":"#/components/schemas/FileMetadata","description":"Attached file metadata"}},"required":["id","fileId","fragmentId","attachedAt"]},"FileAttachmentRequest":{"type":"object","properties":{"fragmentId":{"type":"string","format":"uuid","description":"Fragment ID to attach the file to"},"description":{"type":"string","maxLength":500,"description":"Optional description of the attachment"},"displayOrder":{"type":"integer","minimum":0,"description":"Display order for sorting (default: 0)","example":0}},"required":["fragmentId"]}},"responses":{"UnauthorizedError":{"description":"Authentication required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Unauthorized"}}}},"ForbiddenError":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Insufficient permissions"}}}},"NotFoundError":{"description":"Resource not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Resource not found"}}}},"ValidationError":{"description":"Invalid input data","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ValidationError"}}}},"InternalServerError":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Internal server error"}}}}}},"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"tags":[{"name":"Authentication","description":"Authentication and token management"},{"name":"Workspaces","description":"Workspace management and membership"},{"name":"Memory Fragments","description":"Knowledge fragment CRUD operations"},{"name":"Search","description":"Search and discovery endpoints"},{"name":"Fragment Types","description":"Fragment type management"},{"name":"Notifications","description":"User notifications"},{"name":"Profile","description":"User profile management"},{"name":"Health","description":"API health and status"},{"name":"AI","description":"AI-powered features and integrations"},{"name":"MCP Integration","description":"Model Context Protocol server integration endpoints"},{"name":"Files","description":"File upload, management, and fragment attachment operations"},{"name":"Subscription","description":"Subscription tier management and billing operations"},{"name":"Users","description":"User management endpoints (admin only)"},{"name":"Fragments","description":"Fragment search and listing operations"},{"name":"Payment","description":"Payment confirmation and processing"},{"name":"Analytics","description":"Analytics and usage statistics"}],"paths":{"/api/auth/signin":{"get":{"summary":"Display authentication providers","description":"Show available authentication providers for sign-in. Typically renders a sign-in page with OAuth provider buttons.","tags":["Authentication"],"parameters":[{"name":"callbackUrl","in":"query","schema":{"type":"string","format":"uri"},"description":"URL to redirect to after successful authentication","example":"/dashboard"},{"name":"error","in":"query","schema":{"type":"string"},"description":"Error message to display on sign-in page","example":"CredentialsSignin"}],"responses":{"200":{"description":"Sign-in page HTML","content":{"text/html":{"schema":{"type":"string"}}}},"302":{"description":"Redirect to provider (if direct provider specified)","headers":{"Location":{"schema":{"type":"string","format":"uri"},"description":"Redirect URL"}}}}},"post":{"summary":"Initiate authentication","description":"Start the authentication process with the specified provider","tags":["Authentication"],"requestBody":{"required":true,"content":{"application/x-www-form-urlencoded":{"schema":{"type":"object","required":["provider"],"properties":{"provider":{"type":"string","description":"Authentication provider ID","example":"keycloak"},"callbackUrl":{"type":"string","format":"uri","description":"URL to redirect to after authentication","example":"/dashboard"},"csrfToken":{"type":"string","description":"CSRF protection token"}}}}}},"responses":{"302":{"description":"Redirect to authentication provider","headers":{"Location":{"schema":{"type":"string","format":"uri"},"description":"Provider OAuth authorization URL"}}},"400":{"description":"Invalid request (missing provider, invalid CSRF token, etc.)","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid provider"}}}}}}}}},"/api/auth/signout":{"get":{"summary":"Display sign-out confirmation","description":"Show sign-out confirmation page","tags":["Authentication"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"Sign-out confirmation page HTML","content":{"text/html":{"schema":{"type":"string"}}}}}},"post":{"summary":"Sign out user","description":"Sign out the current user and invalidate their session","tags":["Authentication"],"security":[{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/x-www-form-urlencoded":{"schema":{"type":"object","required":["csrfToken"],"properties":{"csrfToken":{"type":"string","description":"CSRF protection token"},"callbackUrl":{"type":"string","format":"uri","description":"URL to redirect to after sign-out","example":"/"}}}}}},"responses":{"302":{"description":"Redirect after successful sign-out","headers":{"Location":{"schema":{"type":"string","format":"uri"},"description":"Redirect URL (callbackUrl or default)"}}}}}},"/api/auth/callback/{provider}":{"get":{"summary":"OAuth callback handler","description":"Handle OAuth callback from authentication provider (Keycloak). This endpoint receives the authorization code and completes the OAuth flow.","tags":["Authentication"],"parameters":[{"name":"provider","in":"path","required":true,"schema":{"type":"string","enum":["keycloak"]},"description":"OAuth provider identifier","example":"keycloak"},{"name":"code","in":"query","schema":{"type":"string"},"description":"OAuth authorization code from provider","example":"def50200..."},{"name":"state","in":"query","schema":{"type":"string"},"description":"OAuth state parameter for CSRF protection"},{"name":"error","in":"query","schema":{"type":"string"},"description":"Error code if authentication failed","example":"access_denied"},{"name":"error_description","in":"query","schema":{"type":"string"},"description":"Human-readable error description"}],"responses":{"302":{"description":"Redirect after processing callback","headers":{"Location":{"schema":{"type":"string","format":"uri"},"description":"Redirect URL - success goes to callbackUrl, error goes to error page"}}}}}},"/api/auth/session":{"get":{"summary":"Get current session","description":"Retrieve the current user's session information including user profile and authentication status","tags":["Authentication"],"responses":{"200":{"description":"Current session information","content":{"application/json":{"schema":{"oneOf":[{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"string","description":"NextAuth user ID"},"dbId":{"type":"string","format":"uuid","description":"Database user ID"},"email":{"type":"string","format":"email"},"name":{"type":"string"},"image":{"type":"string","format":"uri","nullable":true}}},"expires":{"type":"string","format":"date-time","description":"Session expiration time"}}},{"type":"object","properties":{},"description":"Empty object if not authenticated"}]}}}}}}},"/api/auth/csrf":{"get":{"summary":"Get CSRF token","description":"Retrieve CSRF token for form submissions to NextAuth endpoints","tags":["Authentication"],"responses":{"200":{"description":"CSRF token","content":{"application/json":{"schema":{"type":"object","properties":{"csrfToken":{"type":"string","description":"CSRF protection token"}}}}}}}}},"/api/auth/providers":{"get":{"summary":"Get authentication providers","description":"Retrieve list of configured authentication providers","tags":["Authentication"],"responses":{"200":{"description":"Available authentication providers","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"object","properties":{"id":{"type":"string","example":"keycloak"},"name":{"type":"string","example":"Keycloak"},"type":{"type":"string","example":"oauth"},"signinUrl":{"type":"string","format":"uri"},"callbackUrl":{"type":"string","format":"uri"}}}}}}}}}},"/api/auth/validate-token":{"get":{"summary":"Validate token with middleware protection","description":"Validate a token and return token information using dual authentication middleware. Supports permission checking for specific workspaces.","tags":["Authentication"],"security":[{"BearerAuth":[]}],"parameters":[{"name":"permission","in":"query","schema":{"type":"string"},"description":"Specific permission to check (e.g., 'fragments.read', 'workspace.update')","example":"fragments.read"},{"name":"workspaceId","in":"query","schema":{"type":"string","format":"uuid"},"description":"Workspace ID for permission checking","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Token validation successful","content":{"application/json":{"schema":{"type":"object","properties":{"valid":{"type":"boolean","example":true},"token":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","example":"MCP Server Production"},"workspacePermissions":{"type":"array","items":{"$ref":"#/components/schemas/WorkspacePermission"}},"globalPermissions":{"$ref":"#/components/schemas/GlobalPermissions"},"expiresAt":{"type":"string","format":"date-time","nullable":true},"lastUsedAt":{"type":"string","format":"date-time","nullable":true},"isRevoked":{"type":"boolean"}}},"permissionCheck":{"type":"object","nullable":true,"description":"Permission check result if permission parameter provided","properties":{"hasPermission":{"type":"boolean"},"reason":{"type":"string"}}},"message":{"type":"string","example":"Token is valid and authenticated"}}}}}},"400":{"description":"No token provided","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"No token provided"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Manual token validation","description":"Validate a token directly without middleware protection. Useful for testing token validation logic.","tags":["Authentication"],"security":[{"BearerAuth":[]}],"responses":{"200":{"description":"Token validation successful","content":{"application/json":{"schema":{"type":"object","properties":{"valid":{"type":"boolean","example":true},"token":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string","example":"MCP Server Production"},"workspacePermissions":{"type":"array","items":{"$ref":"#/components/schemas/WorkspacePermission"}},"globalPermissions":{"$ref":"#/components/schemas/GlobalPermissions"},"expiresAt":{"type":"string","format":"date-time","nullable":true},"lastUsedAt":{"type":"string","format":"date-time","nullable":true},"isRevoked":{"type":"boolean"}}},"message":{"type":"string","example":"Token validation successful"}}}}}},"401":{"description":"Token validation failed","content":{"application/json":{"schema":{"type":"object","properties":{"valid":{"type":"boolean","example":false},"error":{"type":"string","example":"Token expired"},"errorType":{"type":"string","example":"EXPIRED_TOKEN"}}}}}},"500":{"description":"Validation error","content":{"application/json":{"schema":{"type":"object","properties":{"valid":{"type":"boolean","example":false},"error":{"type":"string","example":"Validation failed"}}}}}}}}},"/api/tokens":{"get":{"summary":"Get personal access tokens","description":"Retrieve all personal access tokens for the authenticated user","tags":["Authentication"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"List of user's tokens","content":{"application/json":{"schema":{"type":"object","properties":{"tokens":{"type":"array","items":{"$ref":"#/components/schemas/PersonalAccessToken"}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create personal access token","description":"Generate a new personal access token for MCP server integration","tags":["Authentication"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["name","workspacePermissions"],"properties":{"name":{"type":"string","minLength":1,"maxLength":255,"description":"Human-readable name for the token","example":"MCP Server Production"},"workspacePermissions":{"type":"array","items":{"$ref":"#/components/schemas/WorkspacePermission"}},"globalPermissions":{"$ref":"#/components/schemas/GlobalPermissions"},"expiresAt":{"type":"string","format":"date-time","description":"Optional expiration date"}}}}}},"responses":{"201":{"description":"Token created successfully","content":{"application/json":{"schema":{"type":"object","properties":{"tokenId":{"type":"string","format":"uuid"},"token":{"type":"string","description":"Store securely!"},"message":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/tokens/{id}":{"get":{"summary":"Get personal access token details","description":"Retrieve details for a specific personal access token. The token must be owned by the authenticated user.","tags":["Authentication"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Token ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Token details retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"$ref":"#/components/schemas/PersonalAccessToken"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Token not found or not owned by user","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Token not found"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"put":{"summary":"Update personal access token","description":"Update a personal access token's properties. The token must be owned by the authenticated user.","tags":["Authentication"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Token ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","minLength":1,"maxLength":255,"description":"Updated name for the token","example":"MCP Server Production (Updated)"},"workspacePermissions":{"type":"array","items":{"$ref":"#/components/schemas/WorkspacePermission"},"description":"Updated workspace-specific permissions"},"globalPermissions":{"allOf":[{"$ref":"#/components/schemas/GlobalPermissions"}],"description":"Updated global permissions"},"expiresAt":{"type":"string","format":"date-time","nullable":true,"description":"Updated expiration date (null for no expiration)","example":"2024-12-31T23:59:59Z"}}}}}},"responses":{"200":{"description":"Token updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"tokenId":{"type":"string","format":"uuid"},"message":{"type":"string","example":"Token updated successfully"}}}}}},"400":{"description":"Invalid request data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid request data"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Token not found or not owned by user","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Token not found"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Revoke personal access token","description":"Revoke (delete) a personal access token. The token must be owned by the authenticated user. Once revoked, the token cannot be used for authentication.","tags":["Authentication"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Token ID to revoke","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":false,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","description":"Optional reason for revoking the token","example":"No longer needed","default":"Revoked by user"}}}}}},"responses":{"200":{"description":"Token revoked successfully","content":{"application/json":{"schema":{"type":"object","properties":{"tokenId":{"type":"string","format":"uuid"},"message":{"type":"string","example":"Token revoked successfully"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Token not found or not owned by user","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Token not found"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/tokens/{id}/analytics":{"get":{"summary":"Get token usage analytics","description":"Get comprehensive analytics including usage statistics, security events, and performance metrics for a specific token. Only token owners can view analytics.","tags":["Authentication","Analytics"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Token ID"},{"name":"fromDate","in":"query","schema":{"type":"string","format":"date-time"},"description":"Start date for analytics (ISO 8601 format)"},{"name":"toDate","in":"query","schema":{"type":"string","format":"date-time"},"description":"End date for analytics (ISO 8601 format)"}],"responses":{"200":{"description":"Token analytics data","content":{"application/json":{"schema":{"type":"object","properties":{"totalRequests":{"type":"integer","description":"Total number of requests made with this token"},"successfulRequests":{"type":"integer","description":"Number of successful requests (status < 400)"},"failedRequests":{"type":"integer","description":"Number of failed requests (status >= 400)"},"avgResponseTime":{"type":"number","description":"Average response time in milliseconds"},"topEndpoints":{"type":"array","items":{"type":"object","properties":{"endpoint":{"type":"string"},"count":{"type":"integer"},"avgResponseTime":{"type":"number"}}}},"dailyUsage":{"type":"array","items":{"type":"object","properties":{"date":{"type":"string","format":"date"},"requests":{"type":"integer"}}}},"usageLogs":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"endpoint":{"type":"string"},"method":{"type":"string"},"statusCode":{"type":"integer"},"requestDurationMs":{"type":"number","nullable":true},"requestIp":{"type":"string","nullable":true},"userAgent":{"type":"string","nullable":true},"errorMessage":{"type":"string","nullable":true},"mcpTool":{"type":"string","nullable":true,"description":"MCP tool/method name for MCP API requests"},"createdAt":{"type":"string","format":"date-time"}}}},"securityEvents":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"eventType":{"type":"string"},"severity":{"type":"string"},"details":{"type":"object"},"loggedAt":{"type":"string","format":"date-time"}}}}}}}}},"400":{"description":"Invalid date format","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Access denied - token doesn't belong to user","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Token not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/memory-fragments":{"get":{"summary":"Get memory fragments","description":"Retrieve memory fragments with filtering and pagination from a specific workspace","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID to retrieve fragments from (required)"},{"name":"id","in":"query","schema":{"type":"string","format":"uuid"},"description":"Optional: filter by a specific fragment ID (takes precedence over other filters)"},{"name":"fragmentTypeId","in":"query","schema":{"type":"string","format":"uuid"},"description":"Filter by fragment type ID"},{"name":"status","in":"query","schema":{"type":"string","enum":["draft","published","archived"]},"description":"Filter by fragment status"},{"name":"tags","in":"query","style":"form","explode":true,"schema":{"type":"array","items":{"type":"string"}},"description":"Filter by tags (can be specified multiple times)"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":5,"maximum":500},"description":"Number of results to return (min 5, max 500)"},{"name":"offset","in":"query","schema":{"type":"integer","minimum":0},"description":"Number of results to skip"}],"responses":{"200":{"description":"Memory fragments retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fragments":{"type":"array","items":{"$ref":"#/components/schemas/MemoryFragment"}},"count":{"type":"integer","description":"Number of fragments returned"},"filters":{"type":"object","properties":{"workspaceId":{"type":"string","format":"uuid"},"fragmentTypeId":{"type":"string","format":"uuid","nullable":true},"status":{"type":"string","nullable":true},"tags":{"type":"array","items":{"type":"string"}},"id":{"type":"string","format":"uuid","nullable":true}}},"pagination":{"type":"object","properties":{"limit":{"type":"integer","nullable":true},"offset":{"type":"integer","nullable":true}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Workspace not found or access denied"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create memory fragment","description":"Create a new memory fragment in a workspace with event-driven processing","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["workspaceId","fragmentTypeId","title","summary","content"],"properties":{"workspaceId":{"type":"string","format":"uuid","description":"ID of the workspace to create the fragment in"},"fragmentTypeId":{"type":"string","format":"uuid","description":"ID of the fragment type"},"title":{"type":"string","minLength":1,"maxLength":500,"description":"Fragment title"},"summary":{"type":"string","minLength":1,"description":"Fragment summary (required)"},"content":{"type":"string","minLength":1,"description":"Fragment content (supports Markdown)"},"tags":{"type":"array","items":{"type":"string"},"description":"Optional tags for categorization"},"createdVia":{"type":"string","enum":["web","mcp","api"],"description":"How the fragment was created"},"key":{"type":"string","pattern":"^[a-zA-Z0-9_-]+$","minLength":1,"maxLength":255,"description":"Optional human-readable key for workspace-scoped fragment lookup. Must be unique within the workspace. Keys can be used as an alternative to UUIDs for fragment identification.","example":"api-authentication-guide"}}}}}},"responses":{"200":{"description":"Fragment creation initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fragmentId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Memory fragment creation initiated"},"key":{"type":"string","description":"Fragment key if one was provided during creation","example":"api-authentication-guide"}}}}}},"400":{"$ref":"#/components/responses/ValidationError","description":"Invalid input data or invalid fragment type"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - only collaborators and owners can create fragments"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Workspace not found or access denied"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/memory-fragments/{id}":{"get":{"summary":"Get specific memory fragment","description":"Retrieve a specific memory fragment by ID or key. Supports both UUID and human-readable keys. When using a key, workspaceId query parameter is required. User must have read access to the containing workspace.","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"Memory fragment ID (UUID) or human-readable key. If using a key, workspaceId query parameter is required.","example":"550e8400-e29b-41d4-a716-446655440000"},{"name":"workspaceId","in":"query","required":false,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID (required when using a fragment key instead of UUID)","example":"60c10ca2-4115-4c1a-b6d7-04ac39fd3938"}],"responses":{"200":{"description":"Memory fragment retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fragment":{"$ref":"#/components/schemas/FragmentUpdate"},"userRole":{"type":"string","enum":["owner","collaborator","viewer","subscriber"],"description":"User's role in the workspace"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Memory fragment not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Memory fragment not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"patch":{"summary":"Update memory fragment","description":"Update a memory fragment. User must be owner or collaborator in the workspace.","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Memory fragment ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"title":{"type":"string","minLength":1,"maxLength":500,"description":"Updated fragment title"},"summary":{"type":"string","description":"Updated fragment summary"},"content":{"type":"string","minLength":1,"description":"Updated fragment content (Markdown supported)"},"tags":{"type":"array","items":{"type":"string"},"description":"Updated tags array"},"status":{"type":"string","enum":["draft","published","archived"],"description":"Updated fragment status"},"metadata":{"type":"object","properties":{"repository":{"type":"string"},"filePaths":{"type":"array","items":{"type":"string"}},"language":{"type":"string"},"difficulty":{"type":"string","enum":["beginner","intermediate","advanced"]},"estimatedTime":{"type":"number"},"dependencies":{"type":"array","items":{"type":"string"}},"version":{"type":"string"},"lastTested":{"type":"string","format":"date-time"}},"description":"Optional metadata for the fragment"}}}}}},"responses":{"200":{"description":"Fragment update initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fragmentId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Memory fragment update initiated"}}}}}},"400":{"description":"Invalid input data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid input"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions to edit fragment","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Insufficient permissions to edit this memory fragment"}}}}}},"404":{"description":"Memory fragment not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Memory fragment not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Delete or archive memory fragment","description":"Delete or archive a memory fragment. User must be owner or collaborator (for own fragments) in the workspace.","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Memory fragment ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":false,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","description":"Optional reason for deletion/archival"},"archive":{"type":"boolean","description":"If true, archive instead of delete","default":false}}}}}},"responses":{"200":{"description":"Fragment deletion/archival initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fragmentId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"action":{"type":"string","enum":["deleted","archived"]},"message":{"type":"string","example":"Memory fragment deletion initiated"}}}}}},"400":{"description":"Invalid input data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid input"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions to delete fragment","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Insufficient permissions to delete this memory fragment"}}}}}},"404":{"description":"Memory fragment not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Memory fragment not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/memory-fragments/check-limits":{"post":{"summary":"Check fragment creation limits","description":"Check if user can create a memory fragment based on AI token limits and workspace permissions.","tags":["Memory Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["workspaceId","summary"],"properties":{"workspaceId":{"type":"string","format":"uuid","description":"Workspace ID where fragment will be created"},"summary":{"type":"string","minLength":1,"description":"Fragment summary for token estimation"},"tags":{"type":"array","items":{"type":"string"},"description":"Optional tags for token estimation"}}}}}},"responses":{"200":{"description":"Limit check completed successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"canCreate":{"type":"boolean","description":"Whether user can create the fragment"},"limitInfo":{"type":"object","properties":{"tierName":{"type":"string","example":"free"},"tokensNeeded":{"type":"integer","example":150},"tokensUsed":{"type":"integer","example":1200},"tokensLimit":{"type":"integer","example":5000},"tokensRemaining":{"type":"integer","example":3800},"estimatedCostCents":{"type":"number","example":0.03}}},"error":{"type":"string","nullable":true,"description":"Error message if creation not allowed"}}}}}},"400":{"description":"Invalid input data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid input"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions to create fragments","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Insufficient permissions to create fragments"}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces":{"get":{"summary":"Get user workspaces","description":"Retrieve workspaces the user has access to (member and subscribed workspaces)","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"List of accessible workspaces","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"workspaces":{"type":"array","items":{"$ref":"#/components/schemas/Workspace"},"description":"Combined list of member and subscribed workspaces"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create workspace","description":"Create a new workspace. User becomes the owner with full permissions.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["name"],"properties":{"name":{"type":"string","minLength":1,"maxLength":255,"description":"Workspace name","example":"Development Team"},"description":{"type":"string","description":"Optional workspace description","example":"A workspace for our development team collaboration"},"visibility":{"type":"string","enum":["private","public"],"default":"private","description":"Workspace visibility setting"}}}}}},"responses":{"200":{"description":"Workspace creation initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"workspaceId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Workspace creation initiated successfully!"}}}}}},"400":{"description":"Invalid input data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid data"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/accessible":{"get":{"summary":"Get accessible workspaces","description":"Get all workspaces that the user has access to, primarily used for token creation and permission management.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"List of accessible workspaces","content":{"application/json":{"schema":{"type":"object","properties":{"workspaces":{"type":"array","items":{"$ref":"#/components/schemas/Workspace"},"description":"Workspaces accessible to the user"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/discover":{"get":{"summary":"Discover public workspaces","description":"Get public workspaces available for subscription, excluding those the user is already a member of.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"List of discoverable public workspaces","content":{"application/json":{"schema":{"type":"object","properties":{"workspaces":{"type":"array","items":{"$ref":"#/components/schemas/Workspace"},"description":"Public workspaces available for subscription"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"description":"Failed to fetch public workspaces","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Failed to fetch public workspaces"}}}}}}}}},"/api/workspaces/{id}":{"get":{"summary":"Get specific workspace","description":"Retrieve details for a specific workspace. User must have access to the workspace.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Workspace details retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"workspace":{"allOf":[{"$ref":"#/components/schemas/Workspace"},{"type":"object","properties":{"userRole":{"type":"string","enum":["owner","collaborator","viewer","subscriber"],"description":"User's role in this workspace"}}}]}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"put":{"summary":"Update workspace","description":"Update workspace settings. Only workspace owners can update workspace settings.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","minLength":1,"maxLength":255,"description":"Updated workspace name"},"description":{"type":"string","description":"Updated workspace description"},"visibility":{"type":"string","enum":["private","public"],"description":"Updated visibility setting"},"settings":{"type":"object","properties":{"allowGuestAccess":{"type":"boolean","description":"Allow guest access to the workspace"},"defaultMemberRole":{"type":"string","enum":["viewer","collaborator"],"description":"Default role for new members"}},"description":"Workspace settings"}}}}}},"responses":{"200":{"description":"Workspace update initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"workspaceId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Workspace update initiated"}}}}}},"400":{"description":"Invalid input data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid input"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Only workspace owners can update settings","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Only workspace owners can update workspace settings"}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Archive workspace","description":"Archive (soft delete) a workspace. Only workspace owners can archive workspaces. This is a permanent action that archives all contained fragments.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Workspace archive initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"workspaceId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Workspace archive initiated"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Only workspace owners can delete workspaces","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Only workspace owners can delete workspaces"}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/settings":{"get":{"summary":"Get workspace settings","description":"Retrieve workspace settings including concept evolution and tag aliases.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Workspace settings retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WorkspaceSettingsResponse"}}}},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"patch":{"summary":"Update workspace settings","description":"Update concept evolution and tag alias settings. Event-driven: emits workspace.updated event.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateWorkspaceSettingsRequest"}}}},"responses":{"200":{"description":"Workspace settings update initiated","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Workspace settings update initiated"},"settings":{"$ref":"#/components/schemas/WorkspaceSettings"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/subscribe":{"post":{"summary":"Subscribe to public workspace","description":"Subscribe to a public workspace to get read-only access. User will be able to view and search fragments but not create or edit them.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Successfully subscribed to workspace","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"subscriptionId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Successfully subscribed to workspace"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or not public","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or not available for subscription"}}}}}},"409":{"description":"Already subscribed or member","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Already subscribed to this workspace or already a member"}}}}}},"500":{"description":"Failed to subscribe to workspace","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Failed to subscribe to workspace"}}}}}}}}},"/api/workspaces/{id}/unsubscribe":{"post":{"summary":"Unsubscribe from workspace","description":"Unsubscribe from a workspace that user was previously subscribed to. This removes read-only access to the workspace.","tags":["Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID","example":"550e8400-e29b-41d4-a716-446655440000"}],"responses":{"200":{"description":"Successfully unsubscribed from workspace","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"subscriptionId":{"type":"string","format":"uuid"},"status":{"type":"string","example":"processing"},"message":{"type":"string","example":"Successfully unsubscribed from workspace"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or not subscribed","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Not subscribed to this workspace or workspace not found"}}}}}},"500":{"description":"Failed to unsubscribe from workspace","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Failed to unsubscribe from workspace"}}}}}}}}},"/api/workspaces/{id}/mcp-system-prompt":{"get":{"summary":"Generate MCP system prompt","description":"Generate a Model Context Protocol system prompt for a specific workspace, including fragment types and workspace information. Used by MCP servers to integrate with workspace-specific knowledge.","tags":["MCP Integration","Workspaces"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"UUID of the workspace to generate system prompt for","example":"60c10ca2-4115-4c1a-b6d7-04ac39fd3938"}],"responses":{"200":{"description":"System prompt generated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"systemPrompt":{"type":"string","description":"Generated MCP system prompt with workspace context","example":"# Usable MCP Integration\n\nRepository: alminni\nWorkspaceId: 60c10ca2-4115-4c1a-b6d7-04ac39fd3938\nWorkspace: My Workspace\nWorkspace Fragment Types: knowledge, recipe, solution, template\n\n## Fragment Type Mapping\n\n- **Knowledge**: `04a5fb62-1ba5-436c-acf7-f65f3a5ba6f6`\n- **Recipe**: `502a2fcf-ca6f-4b8a-b719-cd50469d3be6`\n..."},"workspaceId":{"type":"string","format":"uuid","description":"The workspace ID used to generate the prompt"},"workspaceName":{"type":"string","description":"Name of the workspace"},"fragmentTypes":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string"},"description":{"type":"string","nullable":true},"icon":{"type":"string"},"color":{"type":"string"},"isSystemDefault":{"type":"boolean"}}},"description":"Available fragment types in the workspace"}}}}}},"400":{"description":"Invalid workspace ID","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid workspace ID"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Access denied - insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Access denied"}}}}}},"404":{"description":"Workspace not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Workspace not found or access denied"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/members":{"get":{"summary":"Get workspace members","description":"Retrieve all members of a workspace. User must have access to the workspace.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"responses":{"200":{"description":"Workspace members retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"members":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"userId":{"type":"string","format":"uuid"},"user":{"$ref":"#/components/schemas/User"},"role":{"type":"string","enum":["owner","collaborator","viewer","subscriber"]},"joinedAt":{"type":"string","format":"date-time"},"invitedBy":{"type":"string","format":"uuid","nullable":true}}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Invite member to workspace","description":"Invite a user to join the workspace. Only owners and collaborators can invite members. Creates a workspace invitation that requires user acceptance.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["email","role"],"properties":{"email":{"type":"string","format":"email","description":"Email address of the user to invite"},"role":{"type":"string","enum":["collaborator","viewer"],"description":"Role to assign to the invited user"}}}}}},"responses":{"200":{"description":"Invitation sent successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Invitation sent successfully"},"invitationId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["pending","accepted","rejected"]}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Only workspace owners and collaborators can invite members","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"User not found or workspace not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"409":{"description":"User is already a member","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/invitations/{id}/accept":{"post":{"summary":"Accept workspace invitation","description":"Accept a pending workspace invitation. User becomes a member of the workspace with the role specified in the invitation.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Invitation ID"}],"responses":{"200":{"description":"Invitation accepted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"invitationId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["accepted"]},"message":{"type":"string","example":"Invitation accepted successfully"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Invitation not found or already processed","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/invitations/{id}/reject":{"post":{"summary":"Reject workspace invitation","description":"Reject a pending workspace invitation. Optional reason can be provided.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Invitation ID"}],"requestBody":{"required":false,"content":{"application/json":{"schema":{"type":"object","properties":{"reason":{"type":"string","description":"Optional reason for rejecting the invitation"}}}}}},"responses":{"200":{"description":"Invitation rejected successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"invitationId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["rejected"]},"message":{"type":"string","example":"Invitation rejected successfully"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Invitation not found or already processed","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/members/{memberId}":{"patch":{"summary":"Update workspace member role","description":"Update a member's role in the workspace. Only workspace owners can update member roles.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"memberId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Member ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["role"],"properties":{"role":{"type":"string","enum":["owner","collaborator","viewer"],"description":"New role for the member"}}}}}},"responses":{"200":{"description":"Member role updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Member role updated successfully"},"workspaceId":{"type":"string","format":"uuid"},"userId":{"type":"string","format":"uuid"},"status":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Only workspace owners can update member roles","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Member not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Remove workspace member","description":"Remove a member from the workspace. Owners can remove any member, members can remove themselves. Sole owners cannot leave.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"memberId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Member ID"}],"responses":{"200":{"description":"Member removed successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Member removed successfully"},"workspaceId":{"type":"string","format":"uuid"},"userId":{"type":"string","format":"uuid"},"status":{"type":"string"}}}}}},"400":{"description":"Cannot leave workspace as sole owner","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Member not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/webhooks":{"get":{"summary":"List workspace webhooks","description":"Retrieve all webhooks configured for a workspace. User must have access to the workspace.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"responses":{"200":{"description":"Webhooks retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"webhooks":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"targetUrl":{"type":"string"},"isActive":{"type":"boolean"},"events":{"type":"object"},"authEnabled":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create or update workspace webhook","description":"Create a new webhook or update an existing one for the workspace. Webhooks receive events when fragments are created, updated, or deleted.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid","description":"Webhook ID (for updates, omit for new webhooks)"},"name":{"type":"string","description":"Webhook name"},"targetUrl":{"type":"string","format":"uri","pattern":"^https://","description":"URL to receive webhook events (HTTPS only). Must not target private IP addresses or localhost for security reasons (SSRF protection)."},"isActive":{"type":"boolean","default":true,"description":"Whether the webhook is active"},"events":{"type":"object","description":"Event subscriptions","properties":{"fragment.created":{"type":"boolean"},"fragment.updated":{"type":"boolean"},"fragment.deleted":{"type":"boolean"}}},"authEnabled":{"type":"boolean","description":"Whether authentication is enabled"},"authHeaderName":{"type":"string","description":"Header name for authentication"},"authHeaderValue":{"type":"string","description":"Header value for authentication"}}}}}},"responses":{"200":{"description":"Webhook created/updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"targetUrl":{"type":"string"},"isActive":{"type":"boolean"},"events":{"type":"object"},"authEnabled":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/webhooks/{webhookId}":{"get":{"summary":"Get workspace webhook","description":"Retrieve details for a specific webhook. User must have access to the workspace.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"webhookId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Webhook ID"}],"responses":{"200":{"description":"Webhook retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"webhook":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"targetUrl":{"type":"string"},"isActive":{"type":"boolean"},"events":{"type":"object"},"authEnabled":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Webhook not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"patch":{"summary":"Update workspace webhook","description":"Update an existing webhook configuration. User must have access to the workspace.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"webhookId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Webhook ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"targetUrl":{"type":"string","format":"uri","pattern":"^https://","description":"URL to receive webhook events (HTTPS only). Must not target private IP addresses or localhost for security reasons (SSRF protection)."},"isActive":{"type":"boolean"},"events":{"type":"object"},"authEnabled":{"type":"boolean"},"authHeaderName":{"type":"string"},"authHeaderValue":{"type":"string"}}}}}},"responses":{"200":{"description":"Webhook updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"targetUrl":{"type":"string"},"isActive":{"type":"boolean"},"events":{"type":"object"},"authEnabled":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Webhook not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Delete workspace webhook","description":"Delete a webhook from the workspace. User must have access to the workspace.","tags":["Workspaces"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"webhookId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Webhook ID"}],"responses":{"200":{"description":"Webhook deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Webhook not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/webhooks/trigger":{"post":{"summary":"Manually trigger webhook events (Test Webhooks)","description":"Manually trigger webhook events for testing webhook integrations. Uses existing fragment data to send fragment.created or fragment.updated events to all active webhooks subscribed to that event type. Adds x-usable-test-trigger: true header to webhook requests. Available to workspace members (owner, admin, collaborator).","tags":["Workspaces","Webhooks"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["fragmentId","eventType"],"properties":{"fragmentId":{"type":"string","format":"uuid","description":"Fragment ID to use for webhook payload","example":"f47ac10b-58cc-4372-a567-0e02b2c3d479"},"eventType":{"type":"string","enum":["fragment.created","fragment.updated","fragment.deleted"],"description":"Type of event to trigger","example":"fragment.updated"}}}}}},"responses":{"200":{"description":"Webhooks triggered successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","description":"Overall success (true if all webhooks succeeded)","example":true},"triggered":{"type":"integer","description":"Total number of webhooks triggered","example":3},"successful":{"type":"integer","description":"Number of webhooks that succeeded","example":2},"failed":{"type":"integer","description":"Number of webhooks that failed","example":1},"webhooks":{"type":"array","description":"Detailed results for each webhook delivery","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid","description":"Webhook ID"},"name":{"type":"string","description":"Webhook name"},"targetUrl":{"type":"string","description":"Webhook target URL"},"responseStatus":{"type":"integer","nullable":true,"description":"HTTP response status code (null if network error)","example":200},"responseTime":{"type":"integer","description":"Response time in milliseconds","example":245},"success":{"type":"boolean","description":"Whether the delivery succeeded","example":true},"error":{"type":"string","description":"Error message if delivery failed","example":"HTTP 500: Internal Server Error"}}}}}}}}},"400":{"description":"Invalid request parameters","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid request parameters"},"details":{"type":"array","items":{"type":"object"}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Insufficient permissions"}}}}}},"404":{"description":"Workspace or fragment not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Fragment not found"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/fragment-types":{"get":{"summary":"Get workspace fragment types","description":"Retrieve all custom fragment types for a workspace. User must have access to the workspace.","tags":["Workspaces","Fragment Types"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"responses":{"200":{"description":"Fragment types retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"fragmentTypes":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"description":{"type":"string"},"icon":{"type":"string"},"color":{"type":"string"},"isSystemDefault":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create workspace fragment type","description":"Create a new custom fragment type for the workspace. Only owners and collaborators can create fragment types.","tags":["Workspaces","Fragment Types"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["name","description","icon","color"],"properties":{"name":{"type":"string","minLength":1,"maxLength":100,"description":"Fragment type name"},"description":{"type":"string","minLength":1,"maxLength":1000,"description":"Fragment type description"},"icon":{"type":"string","minLength":1,"maxLength":50,"description":"Icon identifier"},"color":{"type":"string","minLength":1,"maxLength":50,"description":"Color identifier"}}}}}},"responses":{"201":{"description":"Fragment type created successfully","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"description":{"type":"string"},"icon":{"type":"string"},"color":{"type":"string"},"isSystemDefault":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/workspaces/{id}/fragment-types/{typeId}":{"get":{"summary":"Get workspace fragment type","description":"Retrieve a specific fragment type. User must have access to the workspace.","tags":["Workspaces","Fragment Types"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"typeId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Fragment type ID"}],"responses":{"200":{"description":"Fragment type retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"fragmentType":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"description":{"type":"string"},"icon":{"type":"string"},"color":{"type":"string"},"isSystemDefault":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Fragment type not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"patch":{"summary":"Update workspace fragment type","description":"Update a custom fragment type. Only owners and collaborators can update fragment types. System default types cannot be modified.","tags":["Workspaces","Fragment Types"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"typeId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Fragment type ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","minLength":1,"maxLength":100},"description":{"type":"string","minLength":1,"maxLength":1000},"icon":{"type":"string","minLength":1,"maxLength":50},"color":{"type":"string","minLength":1,"maxLength":50}}}}}},"responses":{"200":{"description":"Fragment type updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"name":{"type":"string"},"description":{"type":"string"},"icon":{"type":"string"},"color":{"type":"string"},"isSystemDefault":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}}}}}},"400":{"description":"Cannot modify system default fragment types","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Fragment type not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Delete workspace fragment type","description":"Delete a custom fragment type. Only owners and collaborators can delete fragment types. System default types and types in use cannot be deleted.","tags":["Workspaces","Fragment Types"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"typeId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Fragment type ID"}],"responses":{"200":{"description":"Fragment type deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true}}}}}},"400":{"description":"Cannot delete system default types or types in use","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"Fragment type not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search":{"get":{"summary":"Search memory fragments","description":"Semantic search across memory fragments using vector embeddings","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","minLength":1},"description":"Search query"},{"name":"workspaceIds","in":"query","schema":{"type":"string"},"description":"Comma-separated workspace IDs to search in"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":100,"default":10}}],"responses":{"200":{"description":"Search results","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchResult"}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search/global":{"get":{"summary":"Global search across accessible workspaces","description":"Search across all workspaces the user has access to including workspaces, fragments, and fragment types","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","minLength":1},"description":"Search query"},{"name":"sortBy","in":"query","schema":{"type":"string","enum":["relevance","date","name","fragments"],"default":"relevance"},"description":"Sort results by relevance, date, name, or fragment count"},{"name":"sortDirection","in":"query","schema":{"type":"string","enum":["asc","desc"],"default":"desc"},"description":"Sort direction"},{"name":"filterType","in":"query","schema":{"type":"string","enum":["all","workspaces","fragments","types"],"default":"all"},"description":"Filter results by type"}],"responses":{"200":{"description":"Global search results","content":{"application/json":{"schema":{"type":"object","properties":{"workspaces":{"type":"array","items":{"$ref":"#/components/schemas/Workspace"}},"fragments":{"type":"array","items":{"$ref":"#/components/schemas/MemoryFragment"}},"fragmentTypes":{"type":"array","items":{"$ref":"#/components/schemas/FragmentType"}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search/saved":{"get":{"summary":"Get saved searches","description":"Retrieve saved search queries for a specific workspace","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"ID of the workspace to get saved searches for"}],"responses":{"200":{"description":"List of saved searches","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"savedSearches":{"type":"array","items":{"$ref":"#/components/schemas/SavedSearch"}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Save search query","description":"Save a search query with filters for future use","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["workspaceId","name"],"properties":{"workspaceId":{"type":"string","format":"uuid","description":"ID of the workspace"},"name":{"type":"string","minLength":1,"maxLength":255,"description":"Display name for the saved search"},"query":{"type":"string","description":"Search query text"},"filters":{"type":"object","properties":{"fragmentTypeIds":{"type":"array","items":{"type":"string","format":"uuid"},"description":"Filter by fragment type IDs"},"tags":{"type":"array","items":{"type":"string"},"description":"Filter by tags"},"authors":{"type":"array","items":{"type":"string","format":"uuid"},"description":"Filter by author user IDs"},"dateRange":{"type":"object","properties":{"from":{"type":"string","format":"date"},"to":{"type":"string","format":"date"}},"description":"Date range filter"},"createdVia":{"type":"array","items":{"type":"string","enum":["web","mcp","api"]},"description":"Filter by creation method"}},"description":"Search filters to save"}}}}}},"responses":{"200":{"description":"Search saved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"savedSearch":{"$ref":"#/components/schemas/SavedSearch"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Delete saved search","description":"Delete a saved search query by ID","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["savedSearchId"],"properties":{"savedSearchId":{"type":"string","format":"uuid","description":"ID of the saved search to delete"}}}}}},"responses":{"200":{"description":"Saved search deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Saved search deleted successfully"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Saved search not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search/analytics":{"get":{"summary":"Get search analytics","description":"Get comprehensive search analytics for a workspace including query trends and popular searches","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"ID of the workspace to get analytics for"},{"name":"dateFrom","in":"query","schema":{"type":"string","format":"date"},"description":"Start date for analytics range"},{"name":"dateTo","in":"query","schema":{"type":"string","format":"date"},"description":"End date for analytics range"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":50,"default":10},"description":"Maximum number of top queries to return"}],"responses":{"200":{"description":"Search analytics data","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"analytics":{"type":"object","properties":{"totalSearches":{"type":"integer","description":"Total number of searches performed"},"uniqueQueries":{"type":"integer","description":"Number of unique search queries"},"averageResultsPerSearch":{"type":"integer","description":"Average number of results per search"},"topQueries":{"type":"array","items":{"type":"object","properties":{"query":{"type":"string"},"count":{"type":"integer"},"avgResults":{"type":"number"}}}},"searchTrends":{"type":"array","items":{"type":"object","properties":{"date":{"type":"string","format":"date"},"count":{"type":"integer"}}}}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search/suggestions":{"get":{"summary":"Get search suggestions","description":"Get autocomplete suggestions for search queries based on previous searches and popular queries","tags":["Search"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"ID of the workspace to get suggestions for"},{"name":"query","in":"query","required":true,"schema":{"type":"string","minLength":1},"description":"Partial search query to get suggestions for"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":20,"default":10},"description":"Maximum number of suggestions to return"}],"responses":{"200":{"description":"Search suggestions","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"suggestions":{"type":"array","items":{"type":"string"},"description":"List of suggested search queries"},"popularQueries":{"type":"array","items":{"type":"string"},"description":"List of popular search queries"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/search/simple":{"get":{"summary":"Simple text search","description":"Fast text search across fragments, concepts, and tags in a workspace. Returns matching fragments, concepts, and tags.","tags":["Search"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID to search within"},{"name":"query","in":"query","required":true,"schema":{"type":"string","minLength":1,"maxLength":200},"description":"Search query text"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":50,"default":10},"description":"Maximum number of results per category"}],"responses":{"200":{"description":"Search completed successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"results":{"type":"object","properties":{"fragments":{"type":"array","items":{"type":"object"}},"concepts":{"type":"array","items":{"type":"object"}},"tags":{"type":"array","items":{"type":"object"}}}},"query":{"type":"string"},"workspaceId":{"type":"string","format":"uuid"},"totalResults":{"type":"object","properties":{"fragments":{"type":"integer"},"concepts":{"type":"integer"},"tags":{"type":"integer"}}}}}}}},"400":{"description":"Invalid input parameters","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Access denied to workspace","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/users":{"get":{"summary":"Get users (Admin only)","description":"Retrieve a list of users with optional search and filtering. Requires admin privileges.","tags":["Users"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"q","in":"query","schema":{"type":"string"},"description":"Search query for user name or email"},{"name":"role","in":"query","schema":{"type":"string","enum":["admin","super_admin","user","collaborator","viewer"]},"description":"Filter by user role"},{"name":"isActive","in":"query","schema":{"type":"boolean"},"description":"Filter by active status"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":100,"default":10},"description":"Maximum number of users to return"},{"name":"offset","in":"query","schema":{"type":"integer","minimum":0,"default":0},"description":"Number of users to skip for pagination"}],"responses":{"200":{"description":"List of users","content":{"application/json":{"schema":{"type":"object","properties":{"users":{"type":"array","items":{"$ref":"#/components/schemas/User"}},"total":{"type":"integer","description":"Total number of users matching the query"},"limit":{"type":"integer"},"offset":{"type":"integer"},"hasMore":{"type":"boolean"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Admin access required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Create user (Admin only)","description":"Create a new user account. Requires admin privileges. Uses event-driven processing.","tags":["Users"],"security":[{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["firstName","lastName","email"],"properties":{"firstName":{"type":"string","minLength":1,"description":"User's first name"},"lastName":{"type":"string","minLength":1,"description":"User's last name"},"email":{"type":"string","format":"email","description":"User's email address"},"company":{"type":"string","description":"User's company name"},"role":{"type":"string","enum":["admin","collaborator","viewer"],"default":"viewer","description":"User's global role"}}}}}},"responses":{"200":{"description":"User creation initiated","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"userId":{"type":"string","format":"uuid"},"eventId":{"type":"string"},"sessionId":{"type":"string"},"message":{"type":"string","example":"User creation initiated"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Admin access required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/profile/analytics":{"get":{"summary":"Get user profile analytics","description":"Get comprehensive analytics for the authenticated user including storage usage, embedding usage, and billing information","tags":["Profile","Analytics"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"User analytics data","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserAnalyticsSummary"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/users/accept-terms":{"post":{"summary":"Accept terms and privacy policy","description":"Accept the current version of terms and privacy policy. Sets an httpOnly cookie and updates user record via event sourcing.","tags":["Users","Profile"],"security":[{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["version"],"properties":{"version":{"type":"string","minLength":1,"description":"Terms version being accepted (e.g., '1.0')","example":"1.0"}}}}}},"responses":{"200":{"description":"Terms accepted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"eventId":{"type":"string"},"message":{"type":"string","example":"Terms and privacy policy accepted"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription":{"get":{"summary":"Get subscription details and usage","description":"Get detailed subscription information including billing period, cost breakdown, and token usage for the authenticated user. This endpoint returns the user's effective tier (resolving organization vs personal billing internally) along with comprehensive usage metrics. **Note:** To determine the billing source (organization vs personal) and see organization details, use `/api/subscription/effective` instead.","tags":["Subscription"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"Subscription information with usage details","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserSubscriptionInfo"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription/effective":{"get":{"summary":"Get effective subscription tier","description":"Get the user's effective subscription tier, automatically resolving whether the user is billing through an organization or their personal account. This is the recommended endpoint for determining what tier a user is operating under and the billing source. **Business Rules:** If user is in an organization â†’ returns organization's tier. If not â†’ returns personal subscription tier. If no subscription â†’ returns free tier. **Note:** For detailed usage and billing information, use `/api/subscription` instead.","tags":["Subscription"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"Effective subscription information","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EffectiveSubscriptionResponse"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription/tiers":{"get":{"summary":"Get available subscription tiers","description":"Get all available subscription tiers with pricing and features","tags":["Subscription"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"Available subscription tiers","content":{"application/json":{"schema":{"type":"object","properties":{"tiers":{"type":"array","items":{"$ref":"#/components/schemas/SubscriptionTier"}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription/change-tier":{"post":{"summary":"Change subscription tier","description":"Upgrade or change the user's subscription tier with payment setup if required","tags":["Subscription"],"security":[{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["tierName"],"properties":{"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"Target subscription tier"}}}}}},"responses":{"200":{"description":"Tier change initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string"},"data":{"type":"object","properties":{"tierName":{"type":"string"},"status":{"type":"string"},"subscriptionId":{"type":"string"},"customerId":{"type":"string"},"customerCreated":{"type":"boolean"},"clientSecret":{"type":"string","description":"Stripe payment confirmation client secret"},"setupIntentSecret":{"type":"string","description":"Stripe setup intent secret for payment method setup"}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription/confirm-payment":{"post":{"summary":"Confirm payment and activate subscription","description":"Confirm payment method setup and activate the subscription after successful payment verification","tags":["Subscription","Payment"],"security":[{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["setupIntentId","tierName"],"properties":{"setupIntentId":{"type":"string","description":"Stripe setup intent ID after payment method setup"},"tierName":{"type":"string","enum":["starter","pro","enterprise"],"description":"Target subscription tier (must be paid tier)"}}}}}},"responses":{"200":{"description":"Payment confirmed and subscription activated","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Payment confirmed and subscription created successfully"},"data":{"type":"object","properties":{"subscriptionId":{"type":"string","description":"Stripe subscription ID"},"status":{"type":"string","enum":["requires_payment_method","requires_confirmation","active","processing"],"description":"Subscription status"},"tierName":{"type":"string","description":"Activated subscription tier"},"clientSecret":{"type":"string","description":"Client secret for additional confirmation if needed (3D Secure, etc.)"}}}}}}}},"400":{"description":"Payment confirmation failed","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"details":{"type":"string","example":"Payment confirmation failed"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Customer mismatch or unauthorized","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Customer mismatch"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/subscription/invoices":{"get":{"summary":"Get user invoices","description":"Retrieve all invoices for the authenticated user from Stripe. Returns empty array for free users without Stripe customer.","tags":["Subscription"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"User invoices retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"invoices":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"amount":{"type":"number"},"currency":{"type":"string"},"status":{"type":"string","enum":["paid","open","void","uncollectible"]},"invoicePdf":{"type":"string","nullable":true},"hostedInvoiceUrl":{"type":"string","nullable":true},"created":{"type":"number"},"periodStart":{"type":"number"},"periodEnd":{"type":"number"}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/ai/embeddings":{"post":{"summary":"Generate text embeddings","description":"Generate vector embeddings for text using OpenAI's text-embedding-3-large model with usage metering and billing","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["text"],"properties":{"text":{"type":"string","minLength":1,"maxLength":8000,"description":"Text to generate embeddings for","example":"This is a sample text for embedding generation"}}}}}},"responses":{"200":{"description":"Embedding generated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"embedding":{"type":"array","items":{"type":"number"},"description":"Vector embedding array"},"model":{"type":"string","example":"text-embedding-3-large"},"tokensUsed":{"type":"integer","description":"Number of tokens used for this request"},"costCents":{"type":"number","description":"Cost in cents (0 for free tier, calculated for paid tiers)"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Rate limit exceeded","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Monthly limit exceeded. 0 tokens remaining."}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/ai/embeddings/usage":{"get":{"summary":"Get embedding usage statistics","description":"Get current monthly embedding usage, limits, and billing information for the authenticated user","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"Embedding usage statistics","content":{"application/json":{"schema":{"type":"object","properties":{"tokensUsed":{"type":"integer","description":"Tokens used this month"},"tokensLimit":{"type":"integer","description":"Monthly token limit (0 for unlimited)"},"tokensRemaining":{"type":"integer","description":"Tokens remaining this month"},"costCents":{"type":"number","description":"Total cost this month in cents"},"tierName":{"type":"string","enum":["free","starter","pro","enterprise"],"description":"User's current subscription tier"},"weekStart":{"type":"string","format":"date","description":"Start of current billing month (kept for API compatibility)"},"isLimitExceeded":{"type":"boolean","description":"Whether the monthly limit has been exceeded"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/ai/generate-summary":{"post":{"summary":"Generate AI summary for fragment","description":"Generate an AI-powered summary for a memory fragment using OpenAI GPT models","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["title","content"],"properties":{"title":{"type":"string","minLength":1,"maxLength":500,"description":"Fragment title for context","example":"How to implement JWT authentication"},"content":{"type":"string","minLength":1,"description":"Fragment content to summarize","example":"JWT (JSON Web Token) is a compact, URL-safe means of representing claims..."},"fragmentType":{"type":"string","description":"Optional fragment type for better context","example":"Knowledge"}}}}}},"responses":{"200":{"description":"Summary generated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"summary":{"type":"string","description":"AI-generated summary of the content","example":"A comprehensive guide to implementing JWT authentication, covering token structure, validation, and security best practices."}}}}}},"400":{"description":"Invalid request data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid request data"},"details":{"type":"object","description":"Validation error details"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"},"503":{"description":"AI features not available","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"AI features are not available. OpenAI API key not configured."}}}}}}}},"get":{"summary":"Check AI summary generation availability","description":"Check if AI summary generation is available (OpenAI configured)","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"AI availability status","content":{"application/json":{"schema":{"type":"object","properties":{"available":{"type":"boolean","description":"Whether AI summary generation is available"},"message":{"type":"string","example":"AI summary generation is available"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/ai/generate-tags":{"post":{"summary":"Generate AI tags for fragment","description":"Generate AI-powered tags for a memory fragment using OpenAI GPT models","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["title","content"],"properties":{"title":{"type":"string","minLength":1,"maxLength":500,"description":"Fragment title for context","example":"How to implement JWT authentication"},"content":{"type":"string","minLength":1,"description":"Fragment content to analyze for tags","example":"JWT (JSON Web Token) is a compact, URL-safe means of representing claims..."},"fragmentType":{"type":"string","description":"Optional fragment type for better context","example":"Knowledge"}}}}}},"responses":{"200":{"description":"Tags generated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"tags":{"type":"array","items":{"type":"string"},"description":"AI-generated tags for the content","example":["jwt","authentication","security","tokens","api"]}}}}}},"400":{"description":"Invalid request data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Invalid request data"},"details":{"type":"object","description":"Validation error details"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"},"503":{"description":"AI features not available","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"AI features are not available. OpenAI API key not configured."}}}}}}}},"get":{"summary":"Check AI tag generation availability","description":"Check if AI tag generation is available (OpenAI configured)","tags":["AI"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"responses":{"200":{"description":"AI availability status","content":{"application/json":{"schema":{"type":"object","properties":{"available":{"type":"boolean","description":"Whether AI tag generation is available"},"message":{"type":"string","example":"AI tag generation is available"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/mcp":{"get":{"summary":"MCP Server Info","description":"Returns comprehensive information about the Usable MCP server including capabilities, tools, and endpoints when accessed via GET request","tags":["MCP Integration"],"security":[{"BearerAuth":[]}],"responses":{"200":{"description":"Comprehensive MCP server information","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","example":"usable-server"},"version":{"type":"string","example":"1.0.0"},"description":{"type":"string","example":"Usable MCP Server - AI-powered memory fragment management"},"protocolVersion":{"type":"string","example":"2024-11-05"},"capabilities":{"type":"object","properties":{"tools":{"type":"object","properties":{"count":{"type":"number","example":14},"list":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"description":{"type":"string"}}},"example":[{"name":"agentic-search-fragments","description":"Unified intelligent search with iterative expansion"},{"name":"create-memory-fragment","description":"Create fragments with auto-classification"}]}}},"prompts":{"type":"object","properties":{"count":{"type":"number","example":1},"list":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"description":{"type":"string"}}},"example":[{"name":"enhance-plan","description":"Enhance a plan by selecting topics, pulling Usable rules/solutions with fragment references, and adding execution reminders plus a concise verification checklist."}]}}},"features":{"type":"array","items":{"type":"string"},"example":["AI-powered fragment classification","Semantic search with embeddings","Multi-workspace support","Real-time SSE notifications","Comprehensive error handling","Rate limiting","Performance monitoring"]}}},"endpoints":{"type":"object","properties":{"jsonRpc":{"type":"string","example":"/api/mcp (POST)"},"sse":{"type":"string","example":"/api/mcp (GET with Accept: text/event-stream)"},"info":{"type":"string","example":"/api/mcp (GET)"}}},"rateLimit":{"type":"object","properties":{"maxRequests":{"type":"number","example":100},"windowMs":{"type":"number","example":60000}}},"documentation":{"type":"string","example":"https://modelcontextprotocol.io/"},"status":{"type":"string","example":"operational"},"timestamp":{"type":"string","format":"date-time"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"}}},"post":{"summary":"MCP JSON-RPC 2.0 Server","description":"Model Context Protocol (MCP) server implementing JSON-RPC 2.0 for AI integration with Usable.\n\n**Protocol**: JSON-RPC 2.0 over HTTP\n**Authentication**: Bearer token with fragments.read and fragments.create permissions\n\n**Available Methods:**\n- `initialize` - Initialize MCP session\n- `tools/list` - Get available tools\n- `tools/call` - Execute a tool\n- `prompts/list` - Get available prompts\n- `prompts/get` - Get a specific prompt with rendered template\n\n**Available Tools:**\n- `agentic-search-fragments` - ðŸš€ NEW: Unified intelligent search with iterative expansion\n- `create-memory-fragment` - Create fragments with auto-classification and tagging\n- `search-memory-fragments` - Advanced semantic search across workspaces (will be deprecated)\n- `get-memory-fragment-content` - Retrieve full fragment content by ID\n- `list-memory-fragments` - Metadata listing with SQL-like filtering (JSONB operators, nested queries, ORDER BY, aggregates)\n- `update-memory-fragment` - Update existing fragments with patch operations support\n- `list-workspaces` - List user's accessible workspaces with permissions\n- `get-fragment-types` - Get available fragment types for workspace\n\n**Required Token Permissions:**\n- `fragments.read` - Required for searching, listing, and graph exploration\n- `fragments.create` - Required for creating fragments","tags":["MCP Integration"],"security":[{"BearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"oneOf":[{"title":"Initialize Request","type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"method":{"type":"string","enum":["initialize"]},"params":{"type":"object","properties":{"protocolVersion":{"type":"string","example":"2024-11-05"},"capabilities":{"type":"object"},"clientInfo":{"type":"object","properties":{"name":{"type":"string"},"version":{"type":"string"}}}}},"id":{"type":["string","number","null"]}},"required":["jsonrpc","method","id"]},{"title":"Tools List Request","type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"method":{"type":"string","enum":["tools/list"]},"id":{"type":["string","number","null"]}},"required":["jsonrpc","method","id"]},{"title":"Tool Call Request","type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"method":{"type":"string","enum":["tools/call"]},"params":{"type":"object","properties":{"name":{"type":"string","enum":["agentic-search-fragments","create-memory-fragment","search-memory-fragments","get-memory-fragment-content","list-memory-fragments","update-memory-fragment","list-workspaces","get-fragment-types"]},"arguments":{"type":"object","description":"Tool-specific arguments based on the tool being called"}},"required":["name"]},"id":{"type":["string","number","null"]}},"required":["jsonrpc","method","params","id"]}]},"examples":{"Initialize":{"summary":"Initialize MCP session","value":{"jsonrpc":"2.0","method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"example-client","version":"1.0.0"}},"id":1}},"List Tools":{"summary":"Get available tools","value":{"jsonrpc":"2.0","method":"tools/list","id":2}},"List Prompts":{"summary":"Get available prompts","value":{"jsonrpc":"2.0","method":"prompts/list","id":14}},"Create Fragment":{"summary":"Create a memory fragment","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"create-memory-fragment","arguments":{"workspaceId":"123e4567-e89b-12d3-a456-426614174000","title":"Docker Setup Guide","content":"# Docker Setup\n\nThis guide explains how to set up Docker for development...","summary":"Complete guide for Docker development setup","tags":["docker","development","guide"],"repository":"api-service","branch":"main","fragmentType":"recipe"}},"id":3}},"Search Fragments":{"summary":"Search memory fragments","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"search-memory-fragments","arguments":{"query":"docker setup","workspaceId":"123e4567-e89b-12d3-a456-426614174000","fragmentType":"recipe","tags":["docker"],"limit":10,"useSemanticSearch":true}},"id":4}},"Get Fragment Content":{"summary":"Get full fragment content by ID","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get-memory-fragment-content","arguments":{"fragmentId":"456e7890-e12b-34d5-a678-901234567890"}},"id":5}},"List Workspaces":{"summary":"List accessible workspaces","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"list-workspaces","arguments":{"includeArchived":false}},"id":6}},"Agentic Search":{"summary":"ðŸš€ NEW: Intelligent search with AI expansion","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"agentic-search-fragments","arguments":{"query":"docker setup troubleshooting","workspaceId":"123e4567-e89b-12d3-a456-426614174000","limit":10,"outputFormat":"text","searchIntent":"Find comprehensive Docker setup and troubleshooting guides","tags":["docker"]}},"id":10}},"Update Fragment":{"summary":"Update existing fragment with patch operations","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"update-memory-fragment","arguments":{"fragmentId":"456e7890-e12b-34d5-a678-901234567890","title":"Updated Docker Setup Guide","patchOperations":[{"type":"add","lineNumber":1,"lines":["# Updated Docker Setup Guide",""]},{"type":"replace","searchText":"old command","replaceText":"docker compose up","replaceAll":false}],"outputFormat":"text"}},"id":11}},"Get Fragment Types":{"summary":"Get available fragment types for workspace","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get-fragment-types","arguments":{"workspaceId":"123e4567-e89b-12d3-a456-426614174000","outputFormat":"text"}},"id":12}},"List Memory Fragments":{"summary":"List fragments with traditional filtering","value":{"jsonrpc":"2.0","method":"tools/call","params":{"name":"list-memory-fragments","arguments":{"workspaceId":"123e4567-e89b-12d3-a456-426614174000","fragmentTypeId":"04a5fb62-1ba5-436c-acf7-f65f3a5ba6f6","tags":["nextjs","api"],"createdAfter":"2024-01-15T00:00:00Z","limit":20,"offset":0,"outputFormat":"json"}},"id":13}},"Get Prompt":{"summary":"Get a specific prompt with rendered template","value":{"jsonrpc":"2.0","method":"prompts/get","params":{"name":"enhance-plan","arguments":{}},"id":15}}}}}},"responses":{"200":{"description":"JSON-RPC 2.0 response","content":{"application/json":{"schema":{"oneOf":[{"title":"Success Response","type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"result":{"type":"object","description":"Method-specific result data"},"id":{"type":["string","number","null"]}},"required":["jsonrpc","result","id"]},{"title":"Error Response","type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"error":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object"}},"required":["code","message"]},"id":{"type":["string","number","null"]}},"required":["jsonrpc","error","id"]}]},"examples":{"Initialize Response":{"summary":"Successful initialization","value":{"jsonrpc":"2.0","result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{},"prompts":{}},"serverInfo":{"name":"usable-server","version":"1.0.0"}},"id":1}},"Tools List Response":{"summary":"Available tools with full schemas","value":{"jsonrpc":"2.0","result":{"tools":[{"name":"agentic-search-fragments","description":"ðŸš€ NEW: Agentic search with iterative expansion: primes vector results and, when needed, expands in parallel via reformulated queries and graph starting-point exploration","inputSchema":{"type":"object","properties":{"query":{"type":"string","minLength":1,"maxLength":2000,"description":"Natural-language query used to prime retrieval"},"context":{"type":"string","maxLength":3000,"description":"Optional additional context to guide relevance"},"searchIntent":{"type":"string","maxLength":1000,"description":"High-level objective used to bias selection and expansion steps"},"workspaceId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"Primary workspace scope"},"limit":{"type":"number","minimum":5,"maximum":50,"default":10,"description":"Number of fragments to return (5-50)"},"outputFormat":{"type":"string","enum":["text","json"],"default":"text","description":"Response format"}},"required":["query","limit","outputFormat"]}},{"name":"create-memory-fragment","description":"Create a new memory fragment in a workspace with AI-powered auto-classification and tagging","inputSchema":{"type":"object","properties":{"workspaceId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"UUID of the workspace to create the fragment in"},"title":{"type":"string","minLength":1,"maxLength":500,"description":"Title of the memory fragment (1-500 characters)"},"content":{"type":"string","minLength":1,"maxLength":50000,"description":"Content of the memory fragment (1-50,000 characters)"},"summary":{"type":"string","minLength":1,"maxLength":5000,"description":"Brief summary of the fragment (1-5,000 characters)"},"tags":{"type":"array","items":{"type":"string","minLength":1,"maxLength":50,"pattern":"^[a-zA-Z0-9_:-]+$"},"maxItems":20,"description":"Optional tags for the fragment (max 20 tags, alphanumeric + underscore/dash/colon only)"},"repository":{"type":"string","minLength":1,"maxLength":100,"pattern":"^[a-zA-Z0-9_.-]+$","description":"Repository context (e.g., 'api-service')"},"branch":{"type":"string","minLength":1,"maxLength":100,"pattern":"^[a-zA-Z0-9_.-/]+$","description":"Git branch context"},"fragmentTypeId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"Fragment type UUID, auto-classified if not provided"}},"required":["workspaceId","title","content"]}},{"name":"search-memory-fragments","description":"Search for memory fragments using advanced chunked vector search with similarity scores for LLM re-ranking","inputSchema":{"type":"object","properties":{"query":{"type":"string","minLength":1,"maxLength":500,"description":"Search query (1-500 characters)"},"workspaceId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"Optional workspace UUID to limit search scope"},"fragmentType":{"type":"string","enum":["knowledge","recipe","solution","template"],"description":"Optional fragment type filter"},"tags":{"type":"array","items":{"type":"string","minLength":1,"maxLength":50,"pattern":"^[a-zA-Z0-9_-]+$"},"maxItems":10,"description":"Optional tags to filter by (max 10 tags)"},"limit":{"type":"number","minimum":1,"maximum":50,"default":10,"description":"Maximum number of results to return (1-50, default: 10)"},"useSemanticSearch":{"type":"boolean","default":true,"description":"Enable AI-enhanced semantic search (default: true)"},"similarityThreshold":{"type":"integer","minimum":0,"maximum":100,"description":"Minimum similarity score for semantic search results (0-100, default: 10)"}},"required":["query"]}},{"name":"get-memory-fragment-content","description":"Get full content of a memory fragment by ID for detailed analysis and deep-dive access","inputSchema":{"type":"object","properties":{"fragmentId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"UUID of the memory fragment to retrieve"}},"required":["fragmentId"]}},{"name":"list-workspaces","description":"List all accessible workspaces for the current user with role and permission information","inputSchema":{"type":"object","properties":{"includeArchived":{"type":"boolean","default":false,"description":"Include archived workspaces in results (default: false)"}}}},{"name":"update-memory-fragment","description":"Update existing memory fragment content, metadata, tags, or status with support for precise patch operations","inputSchema":{"type":"object","properties":{"fragmentId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"UUID of the memory fragment to update"},"title":{"type":"string","minLength":1,"maxLength":500,"description":"Updated title for the fragment"},"content":{"type":"string","minLength":1,"maxLength":50000,"description":"Complete content replacement (cannot be used with patchOperations)"},"patchOperations":{"type":"array","description":"Array of patch operations for precise content modifications","items":{"anyOf":[{"type":"object","properties":{"type":{"const":"add"},"lineNumber":{"type":"number","minimum":1},"lines":{"type":"array","items":{"type":"string"}}},"required":["type","lineNumber","lines"]},{"type":"object","properties":{"type":{"const":"delete"},"startLine":{"type":"number","minimum":1},"endLine":{"type":"number","minimum":1}},"required":["type","startLine","endLine"]},{"type":"object","properties":{"type":{"const":"replace"},"searchText":{"type":"string","minLength":1},"replaceText":{"type":"string"},"replaceAll":{"type":"boolean","default":false}},"required":["type","searchText","replaceText"]}]}},"outputFormat":{"type":"string","enum":["text","json"],"default":"text"}},"required":["fragmentId","outputFormat"]}},{"name":"get-fragment-types","description":"Retrieve all available fragment types for a workspace including system defaults and custom types","inputSchema":{"type":"object","properties":{"workspaceId":{"type":"string","pattern":"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$","description":"UUID of workspace to get fragment types for"},"outputFormat":{"type":"string","enum":["text","json"],"default":"text"}},"required":["workspaceId","outputFormat"]}}]},"id":2}},"Fragment Created":{"summary":"Fragment creation success","value":{"jsonrpc":"2.0","result":{"content":[{"type":"text","text":"Successfully created recipe fragment \"Docker Setup Guide\" in workspace \"Development Team\"\nFragment ID: 456e7890-e12b-34d5-a678-901234567890\nTags: docker, development, guide, repo:api-service, branch:main"}]},"id":3}},"Search Results":{"summary":"Fragment search results","value":{"jsonrpc":"2.0","result":{"content":[{"type":"text","text":"Found 2 fragments for \"docker setup\":\n\n1. **Docker Setup Guide** (Recipe)\nWorkspace: Development Team\nSummary: Complete guide for Docker development setup\nTags: docker, development, guide\nCreated: 1/15/2024\nAuthor: John Doe\n---\n\n2. **Docker Troubleshooting** (Solution)\nWorkspace: Development Team\nSummary: Common Docker issues and solutions\nTags: docker, troubleshooting\nCreated: 1/10/2024\nAuthor: Jane Smith\n---"}]},"id":4}},"Fragment Content":{"summary":"Full fragment content retrieval","value":{"jsonrpc":"2.0","result":{"content":[{"type":"text","text":"**Docker Setup Guide** (Recipe)\nWorkspace: Development Team\nFragment ID: 456e7890-e12b-34d5-a678-901234567890\nCreated: 1/15/2024 by John Doe\nTags: docker, development, guide, repo:api-service, branch:main\n\n---\n\n# Docker Setup\n\nThis guide explains how to set up Docker for development...\n\n## Prerequisites\n- Install Docker Desktop\n- Verify installation with `docker --version`\n\n## Configuration\n..."}]},"id":5}},"Workspace List":{"summary":"User's accessible workspaces","value":{"jsonrpc":"2.0","result":{"content":[{"type":"text","text":"Your accessible workspaces (2):\n\n1. **Development Team** (123e4567-e89b-12d3-a456-426614174000)\nRole: owner\nVisibility: private\nDescription: Main development workspace\nFragments: 45 | Members: 8\n---\n\n2. **Public Knowledge** (456e7890-e12b-34d5-a678-901234567890)\nRole: subscriber\nVisibility: public\nDescription: Community knowledge sharing\nFragments: 127 | Members: 23\n---"}]},"id":6}},"Permission Error":{"summary":"Insufficient permissions","value":{"jsonrpc":"2.0","error":{"code":-32003,"message":"Forbidden - Missing required MCP permissions (fragments.read and fragments.create)"},"id":null}},"Validation Error":{"summary":"Invalid tool parameters","value":{"jsonrpc":"2.0","error":{"code":-32602,"message":"Invalid params - workspaceId, title, and content are required"},"id":3}}}}}},"400":{"description":"Bad Request - Invalid JSON or malformed request","content":{"application/json":{"schema":{"type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"error":{"type":"object","properties":{"code":{"type":"integer","example":-32700},"message":{"type":"string","example":"Parse error - Invalid JSON"}}},"id":{"type":"null"}}}}}},"401":{"description":"Unauthorized - Invalid or missing API token","content":{"application/json":{"schema":{"type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"error":{"type":"object","properties":{"code":{"type":"integer","example":-32001},"message":{"type":"string","example":"Unauthorized - Invalid or missing API token"}}},"id":{"type":"null"}}}}}},"403":{"description":"Forbidden - Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"jsonrpc":{"type":"string","enum":["2.0"]},"error":{"type":"object","properties":{"code":{"type":"integer","example":-32003},"message":{"type":"string","example":"Forbidden - Missing required MCP permissions"}}},"id":{"type":"null"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/health":{"get":{"summary":"API health check","description":"Check API status and availability","tags":["Health"],"security":[{"BearerAuth":[]}],"responses":{"200":{"description":"API is healthy","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"string","example":"healthy"},"timestamp":{"type":"string","format":"date-time"},"version":{"type":"string","example":"1.4.0"},"authenticated":{"type":"boolean","description":"Whether the request was authenticated"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/version":{"get":{"summary":"Get application version","description":"Returns the current application version with major version reduced by 1 (e.g., package.json '1.80.2' returns 'v0.80.2'). Supports cross-origin requests.","tags":["Health"],"responses":{"200":{"description":"Version retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"version":{"type":"string","example":"v0.80.2","description":"Application version with major version reduced by 1"},"success":{"type":"boolean","example":true}}}}},"headers":{"Access-Control-Allow-Origin":{"description":"CORS header allowing all origins","schema":{"type":"string","example":"*"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string","example":"Failed to get version"},"success":{"type":"boolean","example":false}}}}}}}},"options":{"summary":"CORS preflight for version endpoint","description":"Handle CORS preflight requests for cross-origin access to version information","tags":["Health"],"responses":{"204":{"description":"CORS preflight successful","headers":{"Access-Control-Allow-Origin":{"description":"CORS header allowing all origins","schema":{"type":"string","example":"*"}},"Access-Control-Allow-Methods":{"description":"Allowed HTTP methods","schema":{"type":"string","example":"GET, OPTIONS"}},"Access-Control-Allow-Headers":{"description":"Allowed headers","schema":{"type":"string","example":"Accept, Content-Type"}},"Access-Control-Max-Age":{"description":"Cache duration for preflight response","schema":{"type":"string","example":"86400"}}}}}}},"/api/docs":{"get":{"summary":"Get OpenAPI specification","description":"Returns the complete OpenAPI 3.0 specification for the Usable API. This endpoint is publicly accessible and used by API documentation tools.","tags":["Health"],"responses":{"200":{"description":"OpenAPI specification","content":{"application/json":{"schema":{"type":"object","description":"Complete OpenAPI 3.0 specification"}}},"headers":{"Access-Control-Allow-Origin":{"description":"CORS header allowing all origins","schema":{"type":"string","example":"*"}},"Access-Control-Allow-Methods":{"description":"Allowed HTTP methods","schema":{"type":"string","example":"GET"}},"Access-Control-Allow-Headers":{"description":"Allowed headers","schema":{"type":"string","example":"Content-Type"}}}}}}},"/api/fragments/agentic-search":{"post":{"summary":"Agentic search for memory fragments","description":"Perform intelligent iterative search for memory fragments using AI-powered semantic search with automatic expansion. This endpoint uses vector-based semantic search that understands meaning, not just keywords. It performs iterative expansion to find the most relevant fragments and provides a decision on whether sufficient information was found.","tags":["Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgenticSearchRequest"}}}},"responses":{"200":{"description":"Agentic search results with selected fragments","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgenticSearchResponse"}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/fragments/list":{"post":{"summary":"List memory fragments with filtering","description":"List memory fragments with powerful SQL-like filtering capabilities. Supports traditional filters (tags, status, fragment type, dates) and advanced SQL WHERE clauses for complex queries. Returns metadata only (title, summary, tags, dates, author, fragment type) without full content - use GET /api/memory-fragments/{id} to fetch full content by ID.","tags":["Fragments"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListFragmentsRequest"}}}},"responses":{"200":{"description":"List of memory fragments matching the filters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListFragmentsResponse"}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/fragments/{id}/files":{"get":{"summary":"Get files attached to a fragment","description":"Retrieve all files attached to a specific memory fragment. Returns attachment metadata including file information.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Fragment ID"}],"responses":{"200":{"description":"File attachments retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"attachments":{"type":"array","items":{"$ref":"#/components/schemas/FileAttachment"},"description":"List of file attachments, sorted by displayOrder"}},"required":["success","attachments"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Access denied to fragment"},"404":{"description":"Fragment not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Fragment not found or access denied"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/upload":{"post":{"summary":"Upload a file to a workspace","description":"Upload a file to a workspace using multipart/form-data. The file is processed asynchronously using a fire-and-forget pattern. Returns immediately with a fileId for status polling. Files are chunked automatically by Flowcore Pathways for large uploads.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"type":"object","required":["file","workspaceId"],"properties":{"file":{"type":"string","format":"binary","description":"File to upload (max 50MB)"},"workspaceId":{"type":"string","format":"uuid","description":"Workspace ID to upload the file to"},"tags":{"type":"string","description":"JSON array or comma-separated list of tags. Example: '[\"document\", \"report\"]' or 'document,report'"}}}}}},"responses":{"200":{"description":"File upload initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fileId":{"type":"string","description":"File ID for status polling and future operations","example":"a1b2c3d4e5f6"},"status":{"type":"string","enum":["uploading"],"example":"uploading"},"message":{"type":"string","example":"File upload initiated"}},"required":["success","fileId","status"]}}}},"400":{"description":"Invalid file or missing required fields","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"File exceeds 50MB limit"}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - requires fragments.write permission"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/search":{"get":{"summary":"Search files in a workspace","description":"Search for files in a workspace by keyword, tags, or MIME type. Returns file metadata without file content.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID to search files in"},{"name":"query","in":"query","schema":{"type":"string"},"description":"Keyword search query to match against file names (case-insensitive partial matching)"},{"name":"tags","in":"query","schema":{"type":"string","description":"JSON array of tags. Files must have at least one of these tags"},"example":"[\"document\", \"report\"]"},{"name":"mimeTypes","in":"query","schema":{"type":"string","description":"JSON array of MIME types to filter by"},"example":"[\"application/pdf\", \"image/png\"]"},{"name":"limit","in":"query","schema":{"type":"integer","minimum":1,"maximum":100,"default":50},"description":"Maximum number of files to return"},{"name":"offset","in":"query","schema":{"type":"integer","minimum":0,"default":0},"description":"Number of files to skip for pagination"}],"responses":{"200":{"description":"Files retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileSearchResponse"}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Workspace not found or access denied"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/{id}":{"get":{"summary":"Get file metadata","description":"Retrieve file metadata by ID. Does not include file content.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"}],"responses":{"200":{"description":"File metadata retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"file":{"$ref":"#/components/schemas/FileMetadata"}},"required":["success","file"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Access denied to file's workspace"},"404":{"description":"File not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"File not found"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"patch":{"summary":"Update file metadata","description":"Update file name or tags. Processing happens asynchronously via Flowcore Pathways.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileUpdate"}}}},"responses":{"200":{"description":"File update initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fileId":{"type":"string"},"status":{"type":"string","enum":["processing"],"example":"processing"},"message":{"type":"string","example":"File update initiated"}},"required":["success","fileId","status"]}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - requires fragments.write permission"},"404":{"description":"File not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Delete a file","description":"Soft delete a file (marks as deleted, storage decremented in next billing period). Processing happens asynchronously via Flowcore Pathways.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"},{"name":"reason","in":"query","schema":{"type":"string"},"description":"Optional reason for deletion"}],"responses":{"200":{"description":"File deletion initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fileId":{"type":"string"},"status":{"type":"string","enum":["processing"],"example":"processing"},"message":{"type":"string","example":"File deletion initiated"}},"required":["success","fileId","status"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - requires fragments.write permission and cannot be viewer role"},"404":{"description":"File not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/{id}/download":{"get":{"summary":"Download a file","description":"Download a file by ID. Returns binary file data with appropriate Content-Type and Content-Disposition headers.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"}],"responses":{"200":{"description":"File content","content":{"application/octet-stream":{"schema":{"type":"string","format":"binary"}}},"headers":{"Content-Type":{"schema":{"type":"string"},"description":"MIME type of the file"},"Content-Disposition":{"schema":{"type":"string"},"description":"Attachment disposition with filename. Example: 'attachment; filename=\"document.pdf\"'"},"Content-Length":{"schema":{"type":"integer"},"description":"File size in bytes"}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Access denied to file's workspace"},"404":{"description":"File not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"File not found"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/{id}/status":{"get":{"summary":"Get file upload status","description":"Check the upload status of a file. Useful for polling after initiating an upload. Returns status and progress percentage.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"}],"responses":{"200":{"description":"File status retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"fileId":{"type":"string","example":"a1b2c3d4e5f6"},"status":{"$ref":"#/components/schemas/FileStatus"}},"required":["success","fileId","status"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"File not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/{id}/attachments":{"post":{"summary":"Attach file to a fragment","description":"Attach a file to a memory fragment. The file must exist and be accessible. The fragment must exist and the user must have update permissions. Processing happens asynchronously via Flowcore Pathways.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID to attach"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileAttachmentRequest"}}}},"responses":{"200":{"description":"File attachment initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"attachmentId":{"type":"string","format":"uuid","description":"Attachment ID"},"fileId":{"type":"string"},"fragmentId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["processing"],"example":"processing"},"message":{"type":"string","example":"File attachment initiated"}},"required":["success","attachmentId","status"]}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - requires fragments.update permission"},"404":{"description":"File or fragment not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Fragment not found or access denied"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"delete":{"summary":"Remove file attachment from fragment","description":"Remove a file attachment from a memory fragment. Processing happens asynchronously via Flowcore Pathways.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"},"description":"File ID"},{"name":"fragmentId","in":"query","required":true,"schema":{"type":"string","format":"uuid"},"description":"Fragment ID to remove the attachment from"},{"name":"attachmentId","in":"query","schema":{"type":"string","format":"uuid"},"description":"Optional attachment ID. If not provided, looks up by fileId and fragmentId"}],"responses":{"200":{"description":"File attachment removal initiated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"attachmentId":{"type":"string","format":"uuid"},"status":{"type":"string","enum":["processing"],"example":"processing"},"message":{"type":"string","example":"File attachment removal initiated"}},"required":["success","attachmentId","status"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"$ref":"#/components/responses/ForbiddenError","description":"Insufficient permissions - requires fragments.update permission"},"404":{"description":"Attachment or fragment not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"error":"Attachment not found"}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/{id}/cancel":{"post":{"summary":"Cancel file upload","description":"Cancel an incomplete file upload. Requires workspace access and file ownership verification.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"File ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["workspaceId"],"properties":{"workspaceId":{"type":"string","format":"uuid","description":"Workspace ID where the file is being uploaded"}}}}}},"responses":{"200":{"description":"Upload cancelled successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"File not found in workspace","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/files/bulk-delete":{"post":{"summary":"Bulk delete files","description":"Delete multiple files in a workspace. Only owners and collaborators can delete files. Maximum 100 files per request.","tags":["Files"],"security":[{"BearerAuth":[]},{"SessionAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["fileIds","workspaceId"],"properties":{"fileIds":{"type":"array","items":{"type":"string","format":"uuid"},"minItems":1,"maxItems":100,"description":"Array of file IDs to delete"},"workspaceId":{"type":"string","format":"uuid","description":"Workspace ID containing the files"},"reason":{"type":"string","description":"Optional reason for deletion"}}}}}},"responses":{"200":{"description":"Files deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"deleted":{"type":"integer","description":"Number of files successfully deleted"},"notFound":{"type":"integer","description":"Number of files not found"},"fileIds":{"type":"array","items":{"type":"string","format":"uuid"},"description":"IDs of successfully deleted files"}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Insufficient permissions to delete files","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"404":{"description":"No files found to delete","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/notifications":{"get":{"summary":"Get user notifications","description":"Retrieve user notifications including workspace invitations. Supports count-only mode for badge display.","tags":["Notifications"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"count","in":"query","schema":{"type":"boolean","default":false},"description":"If true, returns only the count of pending invitations"}],"responses":{"200":{"description":"Notifications retrieved successfully","content":{"application/json":{"schema":{"oneOf":[{"type":"object","properties":{"count":{"type":"integer","description":"Number of pending invitations"}},"required":["count"]},{"type":"object","properties":{"invitations":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"workspaceId":{"type":"string","format":"uuid"},"workspaceName":{"type":"string"},"invitedBy":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string"},"email":{"type":"string","format":"email"},"image":{"type":"string","nullable":true}}},"role":{"type":"string","enum":["collaborator","viewer"]},"status":{"type":"string","enum":["pending","accepted","rejected"]},"invitedAt":{"type":"string","format":"date-time"},"expiresAt":{"type":"string","format":"date-time"}}}},"count":{"type":"integer","description":"Total number of invitations"}},"required":["invitations","count"]}]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/profile":{"get":{"summary":"Get user profile header info","description":"Get basic user profile information for header display (id, isActive, createdAt)","tags":["Profile"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"Profile information retrieved","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"isActive":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"}},"required":["id","isActive","createdAt"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/users/me":{"get":{"summary":"Get current user profile","description":"Get complete profile information for the authenticated user","tags":["Profile","Users"],"security":[{"SessionAuth":[]}],"responses":{"200":{"description":"User profile retrieved","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"email":{"type":"string","format":"email"},"firstName":{"type":"string","nullable":true},"lastName":{"type":"string","nullable":true},"name":{"type":"string"},"image":{"type":"string","nullable":true},"role":{"type":"string","enum":["admin","user"]},"termsAndPrivacy":{"type":"boolean","nullable":true},"isActive":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}},"required":["id","email","name","role","isActive","createdAt","updatedAt"]}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"$ref":"#/components/responses/NotFoundError"},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/graph/workspace/{workspaceId}":{"get":{"summary":"Get workspace knowledge graph","description":"Retrieve the complete knowledge graph for a workspace including nodes (fragments, tags, users, fragment types, concepts) and edges (relationships). Requires graph access subscription tier.","tags":["Analytics"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"},{"name":"includeNodes","in":"query","schema":{"type":"array","items":{"type":"string","enum":["fragments","tags","users","fragment_types","concepts"]},"default":["fragments","tags","users","fragment_types","concepts"]},"description":"Node types to include in the graph","style":"form","explode":false},{"name":"includeEdges","in":"query","schema":{"type":"array","items":{"type":"string","enum":["has_tag","belongs_to_workspace","created_by","is_type","references_concept","similar","related"]}},"description":"Edge types to include (AI edges require AI graph enabled)","style":"form","explode":false},{"name":"maxNodes","in":"query","schema":{"type":"integer","minimum":1,"maximum":1000,"default":200},"description":"Maximum number of nodes to return"}],"responses":{"200":{"description":"Graph data retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"object"}},"edges":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"label":{"type":"string"},"source":{"type":"string"},"target":{"type":"string"}}}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Graph access not available - subscription tier upgrade required","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"message":{"type":"string"},"currentTier":{"type":"string"},"upgradeRequired":{"type":"boolean"},"availableTiers":{"type":"array","items":{"type":"string"}}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/graph/stats/{workspaceId}":{"get":{"summary":"Get workspace graph statistics","description":"Retrieve statistics about the workspace knowledge graph including node counts, edge counts, and top tags. Requires graph access subscription tier.","tags":["Analytics"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"responses":{"200":{"description":"Graph statistics retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"totalNodes":{"type":"integer"},"totalEdges":{"type":"integer"},"nodeTypes":{"type":"object","additionalProperties":{"type":"integer"}},"edgeTypes":{"type":"object","additionalProperties":{"type":"integer"}},"averageConnections":{"type":"number"},"topTags":{"type":"array","items":{"type":"object","properties":{"tag":{"type":"string"},"count":{"type":"integer"}}}}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Graph access not available - subscription tier upgrade required","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"message":{"type":"string"},"currentTier":{"type":"string"},"upgradeRequired":{"type":"boolean"},"availableTiers":{"type":"array","items":{"type":"string"}}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}},"/api/graph/explore/{workspaceId}":{"get":{"summary":"Get latest fragment for graph exploration","description":"Get the latest fragment ID in a workspace to use as a starting point for graph exploration. Requires graph access subscription tier.","tags":["Analytics"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"responses":{"200":{"description":"Latest fragment ID retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"latestFragmentId":{"type":"string","format":"uuid","nullable":true}}}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Graph access not available - subscription tier upgrade required","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"message":{"type":"string"},"currentTier":{"type":"string"},"upgradeRequired":{"type":"boolean"},"availableTiers":{"type":"array","items":{"type":"string"}}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}},"post":{"summary":"Explore workspace knowledge graph","description":"Perform graph exploration starting from specific points (fragments, concepts, tags). Returns connected nodes and edges up to a specified depth. Requires graph access subscription tier.","tags":["Analytics"],"security":[{"SessionAuth":[]}],"parameters":[{"name":"workspaceId","in":"path","required":true,"schema":{"type":"string","format":"uuid"},"description":"Workspace ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"startingPoints":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"type":{"type":"string","enum":["fragment","concept","tag"]}}},"description":"Starting points for exploration (empty array uses latest fragment)"},"depth":{"type":"integer","minimum":1,"maximum":5,"default":2,"description":"Exploration depth"},"includeEdgeTypes":{"type":"array","items":{"type":"string","enum":["has_tag","belongs_to_workspace","created_by","is_type","references_concept","similar","related"]},"description":"Edge types to include (AI edges require AI graph enabled)"},"maxNodes":{"type":"integer","minimum":10,"maximum":500,"default":200,"description":"Maximum number of nodes to return"}}}}}},"responses":{"200":{"description":"Exploration graph data retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"object"}},"edges":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"label":{"type":"string"},"source":{"type":"string"},"target":{"type":"string"},"type":{"type":"string"},"strength":{"type":"number"},"reason":{"type":"string"},"method":{"type":"string"}}}},"explorationInfo":{"type":"object","description":"Metadata about the exploration"}}}}}}}},"400":{"$ref":"#/components/responses/ValidationError"},"401":{"$ref":"#/components/responses/UnauthorizedError"},"403":{"description":"Graph access not available - subscription tier upgrade required","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"},"message":{"type":"string"},"currentTier":{"type":"string"},"upgradeRequired":{"type":"boolean"},"availableTiers":{"type":"array","items":{"type":"string"}}}}}}},"404":{"description":"Workspace not found or access denied","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}}}}},"500":{"$ref":"#/components/responses/InternalServerError"}}}}}}